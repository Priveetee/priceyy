module.exports=[83938,(e,t,r)=>{"use strict";var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o={};((e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})})(o,{SYMBOL_FOR_REQ_CONTEXT:()=>l,getContext:()=>u}),t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of s(t))i.call(e,l)||l===r||a(e,l,{get:()=>t[l],enumerable:!(o=n(t,l))||o.enumerable});return e})(a({},"__esModule",{value:!0}),o);let l=Symbol.for("@vercel/request-context");function u(){let e=globalThis;return e[l]?.get?.()??{}}},90229,(e,t,r)=>{"use strict";Object.create;var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames;Object.getPrototypeOf;var i=Object.prototype.hasOwnProperty,o={};((e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})})(o,{getVercelOidcToken:()=>d,getVercelOidcTokenSync:()=>c}),t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of s(t))i.call(e,l)||l===r||a(e,l,{get:()=>t[l],enumerable:!(o=n(t,l))||o.enumerable});return e})(a({},"__esModule",{value:!0}),o);var l=e.r(83938),u=e.r(84199);async function d(){let t,r="";try{r=c()}catch(e){t=e}try{let[{getTokenPayload:t,isExpired:a},{refreshToken:n}]=await Promise.all([await e.A(67030),await e.A(83671)]);(!r||a(t(r)))&&(await n(),r=c())}catch(e){throw t?.message&&e instanceof Error&&(e.message=`${t.message}
${e.message}`),new u.VercelOidcTokenError("Failed to refresh OIDC token",e)}return r}function c(){let e=(0,l.getContext)().headers?.["x-vercel-oidc-token"]??process.env.VERCEL_OIDC_TOKEN;if(!e)throw Error("The 'x-vercel-oidc-token' header is missing from the request. Do you have the OIDC option enabled in the Vercel project settings?");return e}},90536,(e,t,r)=>{"use strict";var a=Object.defineProperty,n=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o={};((e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})})(o,{getContext:()=>u.getContext,getVercelOidcToken:()=>l.getVercelOidcToken,getVercelOidcTokenSync:()=>l.getVercelOidcTokenSync}),t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of s(t))i.call(e,l)||l===r||a(e,l,{get:()=>t[l],enumerable:!(o=n(t,l))||o.enumerable});return e})(a({},"__esModule",{value:!0}),o);var l=e.r(90229),u=e.r(83938)},99280,e=>{"use strict";let t;e.s(["handler",()=>oP,"patchFetch",()=>oM,"routeModule",()=>oC,"serverHooks",()=>oj,"workAsyncStorage",()=>oN,"workUnitAsyncStorage",()=>oR],99280);var r,a,n,s,i,o,l,u,d,c,p,m,h,f,g,y,v,b,_,w,x,k,T,I,E,S,O,A,C,N,R,j,M,P,Z,$,D,q,U,F,L,V,B,z,K,J,W=e.i(47909),H=e.i(74017),Y=e.i(96250),G=e.i(59756),X=e.i(61916),Q=e.i(69741),ee=e.i(16795),et=e.i(87718),er=e.i(95169),ea=e.i(47587),en=e.i(66012),es=e.i(70101),ei=e.i(74838),eo=e.i(10372),el=e.i(93695);e.i(52474);var eu=e.i(220);e.s(["POST",()=>oO,"maxDuration",()=>oS],1351),e.s(["default",()=>ec],80420),e.i(54048);var ed=e.i(62810);let ec=ed;e.i(80420);var ep=ed,em=Object.defineProperty,eh=Object.defineProperties,ef=Object.getOwnPropertyDescriptors,eg=Object.getOwnPropertySymbols,ey=Object.prototype.hasOwnProperty,ev=Object.prototype.propertyIsEnumerable,eb=(e,t,r)=>t in e?em(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,e_=(e,t)=>{for(var r in t||(t={}))ey.call(t,r)&&eb(e,r,t[r]);if(eg)for(var r of eg(t))ev.call(t,r)&&eb(e,r,t[r]);return e},ew=(e,t)=>eh(e,ef(t)),ex="vercel.ai.error",ek=Symbol.for(ex),eT=class e extends Error{constructor({name:e,message:t,cause:a}){super(t),this[r]=!0,this.name=e,this.cause=a}static isInstance(t){return e.hasMarker(t,ex)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};r=ek;var eI=eT,eE="AI_APICallError",eS=`vercel.ai.error.${eE}`,eO=Symbol.for(eS),eA=class extends eI{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:s,responseBody:i,cause:o,isRetryable:l=null!=n&&(408===n||409===n||429===n||n>=500),data:u}){super({name:eE,message:e,cause:o}),this[a]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=s,this.responseBody=i,this.isRetryable=l,this.data=u}static isInstance(e){return eI.hasMarker(e,eS)}};a=eO;var eC="AI_EmptyResponseBodyError",eN=`vercel.ai.error.${eC}`,eR=Symbol.for(eN),ej=class extends eI{constructor({message:e="Empty response body"}={}){super({name:eC,message:e}),this[n]=!0}static isInstance(e){return eI.hasMarker(e,eN)}};function eM(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}n=eR;var eP="AI_InvalidArgumentError",eZ=`vercel.ai.error.${eP}`,e$=Symbol.for(eZ),eD=class extends eI{constructor({message:e,cause:t,argument:r}){super({name:eP,message:e,cause:t}),this[s]=!0,this.argument=r}static isInstance(e){return eI.hasMarker(e,eZ)}};s=e$;var eq="AI_InvalidPromptError",eU=`vercel.ai.error.${eq}`,eF=Symbol.for(eU),eL=class extends eI{constructor({prompt:e,message:t,cause:r}){super({name:eq,message:`Invalid prompt: ${t}`,cause:r}),this[i]=!0,this.prompt=e}static isInstance(e){return eI.hasMarker(e,eU)}};i=eF;var eV="AI_InvalidResponseDataError",eB=`vercel.ai.error.${eV}`,ez=Symbol.for(eB),eK=class extends eI{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:eV,message:t}),this[o]=!0,this.data=e}static isInstance(e){return eI.hasMarker(e,eB)}};o=ez;var eJ="AI_JSONParseError",eW=`vercel.ai.error.${eJ}`,eH=Symbol.for(eW),eY=class extends eI{constructor({text:e,cause:t}){super({name:eJ,message:`JSON parsing failed: Text: ${e}.
Error message: ${eM(t)}`,cause:t}),this[l]=!0,this.text=e}static isInstance(e){return eI.hasMarker(e,eW)}};l=eH;var eG="AI_LoadAPIKeyError",eX=`vercel.ai.error.${eG}`,eQ=Symbol.for(eX),e0=class extends eI{constructor({message:e}){super({name:eG,message:e}),this[u]=!0}static isInstance(e){return eI.hasMarker(e,eX)}};u=eQ,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var e1="AI_TypeValidationError",e9=`vercel.ai.error.${e1}`,e4=Symbol.for(e9),e2=class e extends eI{constructor({value:e,cause:t}){super({name:e1,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${eM(t)}`,cause:t}),this[d]=!0,this.value=e}static isInstance(e){return eI.hasMarker(e,e9)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};d=e4;var e6="AI_UnsupportedFunctionalityError",e5=`vercel.ai.error.${e6}`,e8=Symbol.for(e5),e3=class extends eI{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:e6,message:t}),this[c]=!0,this.functionality=e}static isInstance(e){return eI.hasMarker(e,e5)}};c=e8;var e7=class extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function te(e){}var tt=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let a;super({start(n){a=function(e){if("function"==typeof e)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=te,onError:r=te,onRetry:a=te,onComment:n}=e,s="",i=!0,o,l="",u="";function d(e){if(""===e)return void(l.length>0&&t({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u="");if(e.startsWith(":")){n&&n(e.slice(e.startsWith(": ")?2:1));return}let r=e.indexOf(":");if(-1!==r){let t=e.slice(0,r),a=" "===e[r+1]?2:1;c(t,e.slice(r+a),e);return}c(e,"",e)}function c(e,t,n){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?a(parseInt(t,10)):r(new e7(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:n}));break;default:r(new e7(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:n}))}}return{feed:function(e){let t=i?e.replace(/^\xEF\xBB\xBF/,""):e,[r,a]=function(e){let t=[],r="",a=0;for(;a<e.length;){let n=e.indexOf("\r",a),s=e.indexOf(`
`,a),i=-1;if(-1!==n&&-1!==s?i=Math.min(n,s):-1!==n?i=n:-1!==s&&(i=s),-1===i){r=e.slice(a);break}{let r=e.slice(a,i);t.push(r),"\r"===e[(a=i+1)-1]&&e[a]===`
`&&a++}}return[t,r]}(`${s}${t}`);for(let e of r)d(e);s=a,i=!1},reset:function(e={}){s&&e.consume&&d(s),i=!0,o=void 0,l="",u="",s=""}}}({onEvent:e=>{n.enqueue(e)},onError(t){"terminate"===e?n.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){a.feed(e)}})}};function tr(...e){return e.reduce((e,t)=>e_(e_({},e),null!=t?t:{}),{})}function ta(e){return Object.fromEntries([...e.headers])}Symbol("Let zodToJsonSchema decide on which parser to use");var tn=(({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let n=()=>{let e=r.length,a=Array(t);for(let n=0;n<t;n++)a[n]=r[Math.random()*e|0];return a.join("")};if(null==e)return n;if(r.includes(a))throw new eD({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return()=>`${e}${a}${n()}`})();function ts(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var ti=["fetch failed","failed to fetch"],to=/"__proto__"\s*:/,tl=/"constructor"\s*:/;function tu(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{let t=JSON.parse(e);return null===t||"object"!=typeof t||!1===to.test(e)&&!1===tl.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let r of(t=[],e)){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in r){let a=r[e];a&&"object"==typeof a&&t.push(a)}}}return e}(t)}finally{Error.stackTraceLimit=t}}var td=Symbol.for("vercel.ai.validator");async function tc({value:e,schema:t}){let r=await tp({value:e,schema:t});if(!r.success)throw e2.wrap({value:e,cause:r.error});return r.value}async function tp({value:e,schema:t}){var r;let a="object"==typeof t&&null!==t&&td in t&&!0===t[td]&&"validate"in t?t:(r=t,{[td]:!0,validate:async e=>{let t=await r["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new e2({value:e,cause:t.issues})}}});try{if(null==a.validate)return{success:!0,value:e,rawValue:e};let t=await a.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:e2.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:e2.wrap({value:e,cause:t}),rawValue:e}}}async function tm({text:e,schema:t}){try{let r=tu(e);if(null==t)return r;return tc({value:r,schema:t})}catch(t){if(eY.isInstance(t)||e2.isInstance(t))throw t;throw new eY({text:e,cause:t})}}async function th({text:e,schema:t}){try{let r=tu(e);if(null==t)return{success:!0,value:r,rawValue:r};return await tp({value:r,schema:t})}catch(t){return{success:!1,error:eY.isInstance(t)?t:new eY({text:e,cause:t}),rawValue:void 0}}}function tf(e){try{return tu(e),!0}catch(e){return!1}}var tg=()=>globalThis.fetch,ty=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i})=>tv({url:e,headers:e_({"Content-Type":"application/json"},t),body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i}),tv=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:s,fetch:i=tg()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:s}),l=ta(o);if(!o.ok){let t;try{t=await n({response:o,url:e,requestBodyValues:r.values})}catch(t){if(ts(t)||eA.isInstance(t))throw t;throw new eA({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(ts(t)||eA.isInstance(t)))throw t;throw new eA({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:r}){if(ts(e))return e;if(e instanceof TypeError&&ti.includes(e.message.toLowerCase())){let a=e.cause;if(null!=a)return new eA({message:`Cannot connect to API: ${a.message}`,cause:a,url:t,requestBodyValues:r,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:r.values})}},tb=e=>async({response:t})=>{let r=ta(t);if(null==t.body)throw new ej({});return{responseHeaders:r,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new tt).pipeThrough(new TransformStream({async transform({data:e},r){"[DONE]"!==e&&r.enqueue(await th({text:e,schema:t}))}}))}({stream:t.body,schema:e})}},t_=e=>async({response:t,url:r,requestBodyValues:a})=>{let n=await t.text(),s=await th({text:n,schema:e}),i=ta(t);if(!s.success)throw new eA({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:i,value:s.value,rawValue:s.rawValue}};Symbol.for("vercel.ai.schema");var{btoa:tw,atob:tx}=globalThis;function tk(e){return null!=e}var tT=(e=>(e.Unknown="unknown",e.OpenAIResponsesV1="openai-responses-v1",e.XAIResponsesV1="xai-responses-v1",e.AnthropicClaudeV1="anthropic-claude-v1",e))(tT||{}),tI=ep.object({id:ep.string().nullish(),format:ep.nativeEnum(tT).nullish(),index:ep.number().optional()}),tE=ep.object({type:ep.literal("reasoning.summary"),summary:ep.string()}).extend(tI.shape),tS=ep.object({type:ep.literal("reasoning.encrypted"),data:ep.string()}).extend(tI.shape),tO=ep.object({type:ep.literal("reasoning.text"),text:ep.string().nullish(),signature:ep.string().nullish()}).extend(tI.shape),tA=ep.union([tE,tS,tO]),tC=ep.union([tA,ep.unknown().transform(()=>null)]),tN=ep.array(tC).transform(e=>e.filter(e=>!!e));ep.union([ep.object({delta:ep.object({reasoning_details:ep.array(tC)})}).transform(e=>e.delta.reasoning_details.filter(tk)),ep.object({message:ep.object({reasoning_details:ep.array(tC)})}).transform(e=>e.message.reasoning_details.filter(tk)),ep.object({text:ep.string(),reasoning_details:ep.array(tC)}).transform(e=>e.reasoning_details.filter(tk))]);var tR=ep.object({error:ep.object({code:ep.union([ep.string(),ep.number()]).nullable().optional().default(null),message:ep.string(),type:ep.string().nullable().optional().default(null),param:ep.any().nullable().optional().default(null)})}),tj=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:s})=>{let i=await a.text(),o=ta(a);if(""===i.trim())return{responseHeaders:o,value:new eA({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=await tm({text:i,schema:e});return{responseHeaders:o,value:new eA({message:t(l),url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new eA({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:tR,errorToMessage:e=>e.error.message}),tM=ep.object({provider:ep.string(),reasoning_details:ep.array(tA).optional(),usage:ep.object({promptTokens:ep.number(),promptTokensDetails:ep.object({cachedTokens:ep.number()}).optional(),completionTokens:ep.number(),completionTokensDetails:ep.object({reasoningTokens:ep.number()}).optional(),totalTokens:ep.number(),cost:ep.number().optional(),costDetails:ep.object({upstreamInferenceCost:ep.number()})})}),tP=ep.object({openrouter:ep.object({reasoning_details:ep.array(tA).optional()}).optional()}).optional();function tZ(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}function t$({url:e,protocols:t}){try{let r=new URL(e);return t.has(r.protocol)}catch(e){return!1}}function tD({part:e,defaultMediaType:t}){var r,a;if(e.data instanceof Uint8Array){let a=function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return tw(t)}(e.data);return`data:${null!=(r=e.mediaType)?r:t};base64,${a}`}let n=e.data.toString();return t$({url:n,protocols:new Set(["http:","https:"])})||n.startsWith("data:")?n:`data:${null!=(a=e.mediaType)?a:t};base64,${n}`}function tq(e,t){var r;let a=e.match(/^data:([^;]+)/);return a&&null!=(r=a[1])?r:t}function tU(e){let t=e.match(/^data:[^;]*;base64,(.+)$/);return t?t[1]:e}function tF(e){var t,r,a;let n=null==e?void 0:e.anthropic,s=null==e?void 0:e.openrouter;return null!=(a=null!=(r=null!=(t=null==s?void 0:s.cacheControl)?t:null==s?void 0:s.cache_control)?r:null==n?void 0:n.cacheControl)?a:null==n?void 0:n.cache_control}ep.union([ep.literal("auto"),ep.literal("none"),ep.literal("required"),ep.object({type:ep.literal("function"),function:ep.object({name:ep.string()})})]);var tL=ep.object({type:ep.literal("image_url"),image_url:ep.object({url:ep.string()})}),tV=ep.union([tL,ep.unknown().transform(()=>null)]),tB=ep.array(tV).transform(e=>e.filter(e=>!!e)),tz=ep.object({id:ep.string().optional(),model:ep.string().optional(),provider:ep.string().optional(),usage:ep.object({prompt_tokens:ep.number(),prompt_tokens_details:ep.object({cached_tokens:ep.number()}).nullish(),completion_tokens:ep.number(),completion_tokens_details:ep.object({reasoning_tokens:ep.number()}).nullish(),total_tokens:ep.number(),cost:ep.number().optional(),cost_details:ep.object({upstream_inference_cost:ep.number().nullish()}).nullish()}).nullish()}),tK=tz.extend({choices:ep.array(ep.object({message:ep.object({role:ep.literal("assistant"),content:ep.string().nullable().optional(),reasoning:ep.string().nullable().optional(),reasoning_details:tN.nullish(),images:tB.nullish(),tool_calls:ep.array(ep.object({id:ep.string().optional().nullable(),type:ep.literal("function"),function:ep.object({name:ep.string(),arguments:ep.string()})})).optional(),annotations:ep.array(ep.object({type:ep.enum(["url_citation"]),url_citation:ep.object({end_index:ep.number(),start_index:ep.number(),title:ep.string(),url:ep.string(),content:ep.string().optional()})})).nullish()}),index:ep.number().nullish(),logprobs:ep.object({content:ep.array(ep.object({token:ep.string(),logprob:ep.number(),top_logprobs:ep.array(ep.object({token:ep.string(),logprob:ep.number()}))})).nullable()}).nullable().optional(),finish_reason:ep.string().optional().nullable()}))}),tJ=ep.union([tz.extend({choices:ep.array(ep.object({delta:ep.object({role:ep.enum(["assistant"]).optional(),content:ep.string().nullish(),reasoning:ep.string().nullish().optional(),reasoning_details:tN.nullish(),images:tB.nullish(),tool_calls:ep.array(ep.object({index:ep.number().nullish(),id:ep.string().nullish(),type:ep.literal("function").optional(),function:ep.object({name:ep.string().nullish(),arguments:ep.string().nullish()})})).nullish(),annotations:ep.array(ep.object({type:ep.enum(["url_citation"]),url_citation:ep.object({end_index:ep.number(),start_index:ep.number(),title:ep.string(),url:ep.string(),content:ep.string().optional()})})).nullish()}).nullish(),logprobs:ep.object({content:ep.array(ep.object({token:ep.string(),logprob:ep.number(),top_logprobs:ep.array(ep.object({token:ep.string(),logprob:ep.number()}))})).nullable()}).nullish(),finish_reason:ep.string().nullable().optional(),index:ep.number().nullish()}))}),tR]),tW=class{constructor(e,t,r){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=e,this.settings=t,this.config=r}getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:a,frequencyPenalty:n,presencePenalty:s,seed:i,stopSequences:o,responseFormat:l,topK:u,tools:d,toolChoice:c}){var p;let m=e_(e_({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:t,temperature:r,top_p:a,frequency_penalty:n,presence_penalty:s,seed:i,stop:o,response_format:l,top_k:u,messages:function(e){var t,r,a,n,s,i;let o=[];for(let{role:l,content:u,providerOptions:d}of e)switch(l){case"system":o.push({role:"system",content:u,cache_control:tF(d)});break;case"user":{if(1===u.length&&(null==(t=u[0])?void 0:t.type)==="text"){let e=null!=(r=tF(d))?r:tF(u[0].providerOptions),t=e?[{type:"text",text:u[0].text,cache_control:e}]:u[0].text;o.push({role:"user",content:t});break}let e=tF(d),a=u.map(t=>{var r,a,n,s,i,o;let l=null!=(r=tF(t.providerOptions))?r:e;switch(t.type){case"text":return{type:"text",text:t.text,cache_control:l};case"file":{if(null==(a=t.mediaType)?void 0:a.startsWith("image/"))return{type:"image_url",image_url:{url:tD({part:t,defaultMediaType:"image/jpeg"})},cache_control:l};let e=String(null!=(o=null!=(i=null==(s=null==(n=t.providerOptions)?void 0:n.openrouter)?void 0:s.filename)?i:t.filename)?o:""),r=tD({part:t,defaultMediaType:"application/pdf"});if(t$({url:r,protocols:new Set(["http:","https:"])}))return{type:"file",file:{filename:e,file_data:r}};return{type:"file",file:{filename:e,file_data:r},cache_control:l}}default:return{type:"text",text:"",cache_control:l}}});o.push({role:"user",content:a});break}case"assistant":{let e="",t="",r=[];for(let a of u)switch(a.type){case"text":e+=a.text;break;case"tool-call":r.push({id:a.toolCallId,type:"function",function:{name:a.toolName,arguments:JSON.stringify(a.input)}});break;case"reasoning":t+=a.text}let s=tP.safeParse(d),i=s.success?null==(n=null==(a=s.data)?void 0:a.openrouter)?void 0:n.reasoning_details:void 0;o.push({role:"assistant",content:e,tool_calls:r.length>0?r:void 0,reasoning:t||void 0,reasoning_details:i&&Array.isArray(i)&&i.length>0?i:void 0,cache_control:tF(d)});break}case"tool":for(let e of u){let t="text"===(i=e).output.type?i.output.value:JSON.stringify(i.output.value);o.push({role:"tool",tool_call_id:e.toolCallId,content:t,cache_control:null!=(s=tF(d))?s:tF(e.providerOptions)})}}return o}(e),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody);if((null==l?void 0:l.type)==="json"&&null!=l.schema)return ew(e_({},m),{response_format:{type:"json_schema",json_schema:e_({schema:l.schema,strict:!0,name:null!=(p=l.name)?p:"response"},l.description&&{description:l.description})}});if(d&&d.length>0){let e=d.filter(e=>"function"===e.type).map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.inputSchema}}));return ew(e_({},m),{tools:e,tool_choice:c?function(e){switch(e.type){case"auto":case"none":case"required":return e.type;case"tool":return{type:"function",function:{name:e.toolName}};default:throw Error(`Invalid tool choice type: ${e}`)}}(c):void 0})}return m}async doGenerate(e){var t,r,a,n,s,i,o,l,u,d,c,p,m,h,f,g,y,v,b,_,w,x,k,T,I;let E=(e.providerOptions||{}).openrouter||{},S=e_(e_({},this.getArgs(e)),E),{value:O,responseHeaders:A}=await ty({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:tr(this.config.headers(),e.headers),body:S,failedResponseHandler:tj,successfulResponseHandler:t_(tK),abortSignal:e.abortSignal,fetch:this.config.fetch}),C=O.choices[0];if(!C)throw Error("No choice in response");let N=O.usage?{inputTokens:null!=(t=O.usage.prompt_tokens)?t:0,outputTokens:null!=(r=O.usage.completion_tokens)?r:0,totalTokens:(null!=(a=O.usage.prompt_tokens)?a:0)+(null!=(n=O.usage.completion_tokens)?n:0),reasoningTokens:null!=(i=null==(s=O.usage.completion_tokens_details)?void 0:s.reasoning_tokens)?i:0,cachedInputTokens:null!=(l=null==(o=O.usage.prompt_tokens_details)?void 0:o.cached_tokens)?l:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},R=null!=(u=C.message.reasoning_details)?u:[],j=R.length>0?R.map(e=>{switch(e.type){case"reasoning.text":if(e.text)return{type:"reasoning",text:e.text};break;case"reasoning.summary":if(e.summary)return{type:"reasoning",text:e.summary};break;case"reasoning.encrypted":if(e.data)return{type:"reasoning",text:"[REDACTED]"}}return null}).filter(e=>null!==e):C.message.reasoning?[{type:"reasoning",text:C.message.reasoning}]:[],M=[];if(M.push(...j),C.message.content&&M.push({type:"text",text:C.message.content}),C.message.tool_calls)for(let e of C.message.tool_calls)M.push({type:"tool-call",toolCallId:null!=(d=e.id)?d:tn(),toolName:e.function.name,input:e.function.arguments});if(C.message.images)for(let e of C.message.images)M.push({type:"file",mediaType:tq(e.image_url.url,"image/jpeg"),data:tU(e.image_url.url)});if(C.message.annotations)for(let e of C.message.annotations)"url_citation"===e.type&&M.push({type:"source",sourceType:"url",id:e.url_citation.url,url:e.url_citation.url,title:e.url_citation.title,providerMetadata:{openrouter:{content:e.url_citation.content||""}}});return{content:M,finishReason:tZ(C.finish_reason),usage:N,warnings:[],providerMetadata:{openrouter:tM.parse({provider:null!=(c=O.provider)?c:"",reasoning_details:null!=(p=C.message.reasoning_details)?p:[],usage:{promptTokens:null!=(m=N.inputTokens)?m:0,completionTokens:null!=(h=N.outputTokens)?h:0,totalTokens:null!=(f=N.totalTokens)?f:0,cost:null==(g=O.usage)?void 0:g.cost,promptTokensDetails:{cachedTokens:null!=(b=null==(v=null==(y=O.usage)?void 0:y.prompt_tokens_details)?void 0:v.cached_tokens)?b:0},completionTokensDetails:{reasoningTokens:null!=(x=null==(w=null==(_=O.usage)?void 0:_.completion_tokens_details)?void 0:w.reasoning_tokens)?x:0},costDetails:{upstreamInferenceCost:null!=(I=null==(T=null==(k=O.usage)?void 0:k.cost_details)?void 0:T.upstream_inference_cost)?I:0}}})},request:{body:S},response:{id:O.id,modelId:O.model,headers:A}}}async doStream(e){var t;let r,a,n,s,i=(e.providerOptions||{}).openrouter||{},o=e_(e_({},this.getArgs(e)),i),{value:l,responseHeaders:u}=await ty({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:tr(this.config.headers(),e.headers),body:ew(e_({},o),{stream:!0,stream_options:"strict"===this.config.compatibility?e_({include_usage:!0},(null==(t=this.settings.usage)?void 0:t.include)?{include_usage:!0}:{}):void 0}),failedResponseHandler:tj,successfulResponseHandler:tb(tJ),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=[],c="other",p={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},m={},h=[],f=!1,g=!1;return{stream:l.pipeThrough(new TransformStream({transform(e,t){var i,o,l,u,y,v,b,_,w,x,k,T,I,E;if(!e.success){c="error",t.enqueue({type:"error",error:e.error});return}let S=e.value;if("error"in S){c="error",t.enqueue({type:"error",error:S.error});return}if(S.provider&&(s=S.provider),S.id&&(n=S.id,t.enqueue({type:"response-metadata",id:S.id})),S.model&&t.enqueue({type:"response-metadata",modelId:S.model}),null!=S.usage){if(p.inputTokens=S.usage.prompt_tokens,p.outputTokens=S.usage.completion_tokens,p.totalTokens=S.usage.prompt_tokens+S.usage.completion_tokens,m.promptTokens=S.usage.prompt_tokens,S.usage.prompt_tokens_details){let e=null!=(i=S.usage.prompt_tokens_details.cached_tokens)?i:0;p.cachedInputTokens=e,m.promptTokensDetails={cachedTokens:e}}if(m.completionTokens=S.usage.completion_tokens,S.usage.completion_tokens_details){let e=null!=(o=S.usage.completion_tokens_details.reasoning_tokens)?o:0;p.reasoningTokens=e,m.completionTokensDetails={reasoningTokens:e}}m.cost=S.usage.cost,m.totalTokens=S.usage.total_tokens}let O=S.choices[0];if((null==O?void 0:O.finish_reason)!=null&&(c=tZ(O.finish_reason)),(null==O?void 0:O.delta)==null)return;let A=O.delta,C=e=>{g||(a=n||tn(),t.enqueue({type:"reasoning-start",id:a}),g=!0),t.enqueue({type:"reasoning-delta",delta:e,id:a||tn()})};if(A.reasoning_details&&A.reasoning_details.length>0)for(let e of(h.push(...A.reasoning_details),A.reasoning_details))switch(e.type){case"reasoning.text":e.text&&C(e.text);break;case"reasoning.encrypted":e.data&&C("[REDACTED]");break;case"reasoning.summary":e.summary&&C(e.summary)}else A.reasoning&&C(A.reasoning);if(A.content&&(g&&!f&&(t.enqueue({type:"reasoning-end",id:a||tn()}),g=!1),f||(r=n||tn(),t.enqueue({type:"text-start",id:r}),f=!0),t.enqueue({type:"text-delta",delta:A.content,id:r||tn()})),A.annotations)for(let e of A.annotations)"url_citation"===e.type&&t.enqueue({type:"source",sourceType:"url",id:e.url_citation.url,url:e.url_citation.url,title:e.url_citation.title,providerMetadata:{openrouter:{content:e.url_citation.content||""}}});if(null!=A.tool_calls)for(let e of A.tool_calls){let r=null!=(l=e.index)?l:d.length-1;if(null==d[r]){if("function"!==e.type)throw new eK({data:e,message:"Expected 'function' type."});if(null==e.id)throw new eK({data:e,message:"Expected 'id' to be a string."});if((null==(u=e.function)?void 0:u.name)==null)throw new eK({data:e,message:"Expected 'function.name' to be a string."});d[r]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(y=e.function.arguments)?y:""},inputStarted:!1,sent:!1};let a=d[r];if(null==a)throw Error("Tool call is missing");(null==(v=a.function)?void 0:v.name)!=null&&(null==(b=a.function)?void 0:b.arguments)!=null&&tf(a.function.arguments)&&(a.inputStarted=!0,t.enqueue({type:"tool-input-start",id:a.id,toolName:a.function.name}),t.enqueue({type:"tool-input-delta",id:a.id,delta:a.function.arguments}),t.enqueue({type:"tool-input-end",id:a.id}),t.enqueue({type:"tool-call",toolCallId:a.id,toolName:a.function.name,input:a.function.arguments}),a.sent=!0);continue}let a=d[r];if(null==a)throw Error("Tool call is missing");a.inputStarted||(a.inputStarted=!0,t.enqueue({type:"tool-input-start",id:a.id,toolName:a.function.name})),(null==(_=e.function)?void 0:_.arguments)!=null&&(a.function.arguments+=null!=(x=null==(w=e.function)?void 0:w.arguments)?x:""),t.enqueue({type:"tool-input-delta",id:a.id,delta:null!=(k=e.function.arguments)?k:""}),(null==(T=a.function)?void 0:T.name)!=null&&(null==(I=a.function)?void 0:I.arguments)!=null&&tf(a.function.arguments)&&(t.enqueue({type:"tool-call",toolCallId:null!=(E=a.id)?E:tn(),toolName:a.function.name,input:a.function.arguments}),a.sent=!0)}if(null!=A.images)for(let e of A.images)t.enqueue({type:"file",mediaType:tq(e.image_url.url,"image/jpeg"),data:tU(e.image_url.url)})},flush(e){var t;if("tool-calls"===c)for(let r of d)r&&!r.sent&&(e.enqueue({type:"tool-call",toolCallId:null!=(t=r.id)?t:tn(),toolName:r.function.name,input:tf(r.function.arguments)?r.function.arguments:"{}"}),r.sent=!0);g&&e.enqueue({type:"reasoning-end",id:a||tn()}),f&&e.enqueue({type:"text-end",id:r||tn()});let n={usage:m};void 0!==s&&(n.provider=s),h.length>0&&(n.reasoning_details=h),e.enqueue({type:"finish",finishReason:c,usage:p,providerMetadata:{openrouter:n}})}})),warnings:[],request:{body:o},response:{headers:u}}}},tH=ep.union([ep.object({id:ep.string().optional(),model:ep.string().optional(),choices:ep.array(ep.object({text:ep.string(),reasoning:ep.string().nullish().optional(),reasoning_details:tN.nullish(),finish_reason:ep.string().nullish(),index:ep.number().nullish(),logprobs:ep.object({tokens:ep.array(ep.string()),token_logprobs:ep.array(ep.number()),top_logprobs:ep.array(ep.record(ep.string(),ep.number())).nullable()}).nullable().optional()})),usage:ep.object({prompt_tokens:ep.number(),prompt_tokens_details:ep.object({cached_tokens:ep.number()}).nullish(),completion_tokens:ep.number(),completion_tokens_details:ep.object({reasoning_tokens:ep.number()}).nullish(),total_tokens:ep.number(),cost:ep.number().optional()}).nullish()}),tR]),tY=class{constructor(e,t,r){this.specificationVersion="v2",this.provider="openrouter",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:a,frequencyPenalty:n,presencePenalty:s,seed:i,responseFormat:o,topK:l,stopSequences:u,tools:d,toolChoice:c}){let{prompt:p}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&e[0]&&"user"===e[0].role&&1===e[0].content.length&&e[0].content[0]&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let n="";for(let{role:t,content:s}of(e[0]&&"system"===e[0].role&&(n+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new eL({message:`Unexpected system message in prompt: ${s}`,prompt:e});case"user":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"file":throw new e3({functionality:"file attachments"});default:return""}}).join("");n+=`${r}:
${e}

`;break}case"assistant":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new e3({functionality:"tool-call messages"});case"tool-result":throw new e3({functionality:"tool-result messages"});case"reasoning":throw new e3({functionality:"reasoning messages"});case"file":throw new e3({functionality:"file attachments"});default:return""}}).join("");n+=`${a}:
${e}

`;break}case"tool":throw new e3({functionality:"tool messages"})}return{prompt:n+=`${a}:
`}}({prompt:e,inputFormat:"prompt"});if(null==d?void 0:d.length)throw new e3({functionality:"tools"});if(c)throw new e3({functionality:"toolChoice"});return e_(e_({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:t,temperature:r,top_p:a,frequency_penalty:n,presence_penalty:s,seed:i,stop:u,response_format:o,top_k:l,prompt:p,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(e){var t,r,a,n,s,i,o,l,u,d,c,p,m,h,f;let g=(e.providerOptions||{}).openrouter||{},y=e_(e_({},this.getArgs(e)),g),{value:v,responseHeaders:b}=await ty({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:tr(this.config.headers(),e.headers),body:y,failedResponseHandler:tj,successfulResponseHandler:t_(tH),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in v)throw Error(`${v.error.message}`);let _=v.choices[0];if(!_)throw Error("No choice in OpenRouter completion response");return{content:[{type:"text",text:null!=(t=_.text)?t:""}],finishReason:tZ(_.finish_reason),usage:{inputTokens:null!=(a=null==(r=v.usage)?void 0:r.prompt_tokens)?a:0,outputTokens:null!=(s=null==(n=v.usage)?void 0:n.completion_tokens)?s:0,totalTokens:(null!=(o=null==(i=v.usage)?void 0:i.prompt_tokens)?o:0)+(null!=(u=null==(l=v.usage)?void 0:l.completion_tokens)?u:0),reasoningTokens:null!=(p=null==(c=null==(d=v.usage)?void 0:d.completion_tokens_details)?void 0:c.reasoning_tokens)?p:0,cachedInputTokens:null!=(f=null==(h=null==(m=v.usage)?void 0:m.prompt_tokens_details)?void 0:h.cached_tokens)?f:0},warnings:[],response:{headers:b}}}async doStream(e){let t=(e.providerOptions||{}).openrouter||{},r=e_(e_({},this.getArgs(e)),t),{value:a,responseHeaders:n}=await ty({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:tr(this.config.headers(),e.headers),body:ew(e_({},r),{stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0}),failedResponseHandler:tj,successfulResponseHandler:tb(tH),abortSignal:e.abortSignal,fetch:this.config.fetch}),s="other",i={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},o={};return{stream:a.pipeThrough(new TransformStream({transform(e,t){var r,a;if(!e.success){s="error",t.enqueue({type:"error",error:e.error});return}let n=e.value;if("error"in n){s="error",t.enqueue({type:"error",error:n.error});return}if(null!=n.usage){if(i.inputTokens=n.usage.prompt_tokens,i.outputTokens=n.usage.completion_tokens,i.totalTokens=n.usage.prompt_tokens+n.usage.completion_tokens,o.promptTokens=n.usage.prompt_tokens,n.usage.prompt_tokens_details){let e=null!=(r=n.usage.prompt_tokens_details.cached_tokens)?r:0;i.cachedInputTokens=e,o.promptTokensDetails={cachedTokens:e}}if(o.completionTokens=n.usage.completion_tokens,n.usage.completion_tokens_details){let e=null!=(a=n.usage.completion_tokens_details.reasoning_tokens)?a:0;i.reasoningTokens=e,o.completionTokensDetails={reasoningTokens:e}}o.cost=n.usage.cost,o.totalTokens=n.usage.total_tokens}let l=n.choices[0];(null==l?void 0:l.finish_reason)!=null&&(s=tZ(l.finish_reason)),(null==l?void 0:l.text)!=null&&t.enqueue({type:"text-delta",delta:l.text,id:tn()})},flush(e){e.enqueue({type:"finish",finishReason:s,usage:i,providerMetadata:{openrouter:{usage:o}}})}})),response:{headers:n}}}};function tG(e={}){var t,r,a,n;let s=null!=(r=null==(n=null!=(t=e.baseURL)?t:e.baseUrl)?void 0:n.replace(/\/$/,""))?r:"https://openrouter.ai/api/v1",i=null!=(a=e.compatibility)?a:"compatible",o=()=>(function(e,...t){let r=Object.fromEntries(Object.entries(null!=e?e:{}).filter(([,e])=>null!==e)),a=[r["user-agent"]||"",...t].filter(Boolean).join(" ");return ew(e_({},r),{"user-agent":a})})(e_({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new e0({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new e0({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new e0({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new e0({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),"ai-sdk/openrouter/1.2.1"),l=(t,r={})=>new tW(t,r,{provider:"openrouter.chat",url:({path:e})=>`${s}${e}`,headers:o,compatibility:i,fetch:e.fetch,extraBody:e.extraBody}),u=(t,r={})=>new tY(t,r,{provider:"openrouter.completion",url:({path:e})=>`${s}${e}`,headers:o,compatibility:i,fetch:e.fetch,extraBody:e.extraBody}),d=(e,t)=>{if(new.target)throw Error("The OpenRouter model function cannot be called with the new keyword.");return"openai/gpt-3.5-turbo-instruct"===e?u(e,t):l(e,t)},c=(e,t)=>d(e,t);return c.languageModel=d,c.chat=l,c.completion=u,c}tG({compatibility:"strict"});var tX="vercel.ai.error",tQ=Symbol.for(tX),t0=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[p]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,tX)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};p=tQ;var t1=t0,t9="AI_APICallError",t4=`vercel.ai.error.${t9}`,t2=Symbol.for(t4),t6=class extends t1{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:i,isRetryable:o=null!=a&&(408===a||409===a||429===a||a>=500),data:l}){super({name:t9,message:e,cause:i}),this[m]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=o,this.data=l}static isInstance(e){return t1.hasMarker(e,t4)}};m=t2;var t5="AI_EmptyResponseBodyError",t8=`vercel.ai.error.${t5}`,t3=Symbol.for(t8),t7=class extends t1{constructor({message:e="Empty response body"}={}){super({name:t5,message:e}),this[h]=!0}static isInstance(e){return t1.hasMarker(e,t8)}};function re(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}h=t3;var rt="AI_InvalidArgumentError",rr=`vercel.ai.error.${rt}`,ra=Symbol.for(rr),rn=class extends t1{constructor({message:e,cause:t,argument:r}){super({name:rt,message:e,cause:t}),this[f]=!0,this.argument=r}static isInstance(e){return t1.hasMarker(e,rr)}};f=ra;var rs="AI_InvalidPromptError",ri=`vercel.ai.error.${rs}`,ro=Symbol.for(ri),rl=class extends t1{constructor({prompt:e,message:t,cause:r}){super({name:rs,message:`Invalid prompt: ${t}`,cause:r}),this[g]=!0,this.prompt=e}static isInstance(e){return t1.hasMarker(e,ri)}};g=ro,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var ru="AI_JSONParseError",rd=`vercel.ai.error.${ru}`,rc=Symbol.for(rd),rp=class extends t1{constructor({text:e,cause:t}){super({name:ru,message:`JSON parsing failed: Text: ${e}.
Error message: ${re(t)}`,cause:t}),this[y]=!0,this.text=e}static isInstance(e){return t1.hasMarker(e,rd)}};y=rc,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var rm="AI_NoSuchModelError",rh=`vercel.ai.error.${rm}`,rf=Symbol.for(rh),rg=class extends t1{constructor({errorName:e=rm,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[v]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return t1.hasMarker(e,rh)}};v=rf,Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var ry="AI_TypeValidationError",rv=`vercel.ai.error.${ry}`,rb=Symbol.for(rv),r_=class e extends t1{constructor({value:e,cause:t}){super({name:ry,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${re(t)}`,cause:t}),this[b]=!0,this.value=e}static isInstance(e){return t1.hasMarker(e,rv)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};b=rb;Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");class rw extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function rx(e){}class rk extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let a;super({start(n){a=function(e){if("function"==typeof e)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=rx,onError:r=rx,onRetry:a=rx,onComment:n}=e,s="",i=!0,o,l="",u="";function d(e){if(""===e)return void(l.length>0&&t({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u="");if(e.startsWith(":")){n&&n(e.slice(e.startsWith(": ")?2:1));return}let r=e.indexOf(":");if(-1!==r){let t=e.slice(0,r),a=" "===e[r+1]?2:1;c(t,e.slice(r+a),e);return}c(e,"",e)}function c(e,t,n){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?a(parseInt(t,10)):r(new rw(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:n}));break;default:r(new rw(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:n}))}}return{feed:function(e){let t=i?e.replace(/^\xEF\xBB\xBF/,""):e,[r,a]=function(e){let t=[],r="",a=0;for(;a<e.length;){let n=e.indexOf("\r",a),s=e.indexOf(`
`,a),i=-1;if(-1!==n&&-1!==s?i=Math.min(n,s):-1!==n?i=n===e.length-1?-1:n:-1!==s&&(i=s),-1===i){r=e.slice(a);break}{let r=e.slice(a,i);t.push(r),"\r"===e[(a=i+1)-1]&&e[a]===`
`&&a++}}return[t,r]}(`${s}${t}`);for(let e of r)d(e);s=a,i=!1},reset:function(e={}){s&&e.consume&&d(s),i=!0,o=void 0,l="",u="",s=""}}}({onEvent:e=>{n.enqueue(e)},onError(t){"terminate"===e?n.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){a.feed(e)}})}}var rT=e.i(48804);e.s([],54033),e.s(["getErrorMap",()=>rj,"setErrorMap",()=>rR],85676),e.s(["ZodError",()=>rA,"ZodIssueCode",()=>rS,"quotelessJson",()=>rO],15235),e.s(["ZodParsedType",()=>rI,"getParsedType",()=>rE,"objectUtil",()=>w,"util",()=>_],42944),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(_||(_={})),(w||(w={})).mergeShapes=(e,t)=>({...e,...t});let rI=_.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),rE=e=>{switch(typeof e){case"undefined":return rI.undefined;case"string":return rI.string;case"number":return Number.isNaN(e)?rI.nan:rI.number;case"boolean":return rI.boolean;case"function":return rI.function;case"bigint":return rI.bigint;case"symbol":return rI.symbol;case"object":if(Array.isArray(e))return rI.array;if(null===e)return rI.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return rI.promise;if("undefined"!=typeof Map&&e instanceof Map)return rI.map;if("undefined"!=typeof Set&&e instanceof Set)return rI.set;if("undefined"!=typeof Date&&e instanceof Date)return rI.date;return rI.object;default:return rI.unknown}},rS=_.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),rO=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class rA extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;for(;a<n.path.length;){let r=n.path[a];a===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof rA))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t=Object.create(null),r=[];for(let a of this.issues)if(a.path.length>0){let r=a.path[0];t[r]=t[r]||[],t[r].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}rA.create=e=>new rA(e);let rC=(e,t)=>{let r;switch(e.code){case rS.invalid_type:r=e.received===rI.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case rS.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,_.jsonStringifyReplacer)}`;break;case rS.unrecognized_keys:r=`Unrecognized key(s) in object: ${_.joinValues(e.keys,", ")}`;break;case rS.invalid_union:r="Invalid input";break;case rS.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${_.joinValues(e.options)}`;break;case rS.invalid_enum_value:r=`Invalid enum value. Expected ${_.joinValues(e.options)}, received '${e.received}'`;break;case rS.invalid_arguments:r="Invalid function arguments";break;case rS.invalid_return_type:r="Invalid function return type";break;case rS.invalid_date:r="Invalid date";break;case rS.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:_.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case rS.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case rS.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case rS.custom:r="Invalid input";break;case rS.invalid_intersection_types:r="Intersection results could not be merged";break;case rS.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case rS.not_finite:r="Number must be finite";break;default:r=t.defaultError,_.assertNever(e)}return{message:r}},rN=rC;function rR(e){rN=e}function rj(){return rN}e.s(["DIRTY",()=>rq,"EMPTY_PATH",()=>rP,"INVALID",()=>rD,"OK",()=>rU,"ParseStatus",()=>r$,"addIssueToContext",()=>rZ,"isAborted",()=>rF,"isAsync",()=>rB,"isDirty",()=>rL,"isValid",()=>rV,"makeIssue",()=>rM],84488);let rM=e=>{let{data:t,path:r,errorMaps:a,issueData:n}=e,s=[...r,...n.path||[]],i={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...n,path:s,message:o}},rP=[];function rZ(e,t){let r=rN,a=rM({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===rC?void 0:rC].filter(e=>!!e)});e.common.issues.push(a)}class r${constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return rD;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return r$.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:n}=a;if("aborted"===t.status||"aborted"===n.status)return rD;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let rD=Object.freeze({status:"aborted"}),rq=e=>({status:"dirty",value:e}),rU=e=>({status:"valid",value:e}),rF=e=>"aborted"===e.status,rL=e=>"dirty"===e.status,rV=e=>"valid"===e.status,rB=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s([],91316),e.s(["BRAND",()=>aD,"NEVER",()=>n_,"Schema",()=>rW,"ZodAny",()=>ac,"ZodArray",()=>af,"ZodBigInt",()=>as,"ZodBoolean",()=>ai,"ZodBranded",()=>aq,"ZodCatch",()=>aZ,"ZodDate",()=>ao,"ZodDefault",()=>aP,"ZodDiscriminatedUnion",()=>ab,"ZodEffects",()=>aR,"ZodEnum",()=>aA,"ZodFirstPartyTypeKind",()=>k,"ZodFunction",()=>aI,"ZodIntersection",()=>a_,"ZodLazy",()=>aE,"ZodLiteral",()=>aS,"ZodMap",()=>ak,"ZodNaN",()=>a$,"ZodNativeEnum",()=>aC,"ZodNever",()=>am,"ZodNull",()=>ad,"ZodNullable",()=>aM,"ZodNumber",()=>an,"ZodObject",()=>ag,"ZodOptional",()=>aj,"ZodPipeline",()=>aU,"ZodPromise",()=>aN,"ZodReadonly",()=>aF,"ZodRecord",()=>ax,"ZodSchema",()=>rW,"ZodSet",()=>aT,"ZodString",()=>aa,"ZodSymbol",()=>al,"ZodTransformer",()=>aR,"ZodTuple",()=>aw,"ZodType",()=>rW,"ZodUndefined",()=>au,"ZodUnion",()=>ay,"ZodUnknown",()=>ap,"ZodVoid",()=>ah,"any",()=>a1,"array",()=>a6,"bigint",()=>aH,"boolean",()=>aY,"coerce",()=>nb,"custom",()=>aV,"date",()=>aG,"datetimeRegex",()=>ar,"discriminatedUnion",()=>a7,"effect",()=>nc,"enum",()=>nl,"function",()=>ns,"instanceof",()=>az,"intersection",()=>ne,"late",()=>aB,"lazy",()=>ni,"literal",()=>no,"map",()=>na,"nan",()=>aW,"nativeEnum",()=>nu,"never",()=>a4,"null",()=>a0,"nullable",()=>nm,"number",()=>aJ,"object",()=>a5,"oboolean",()=>nv,"onumber",()=>ny,"optional",()=>np,"ostring",()=>ng,"pipeline",()=>nf,"preprocess",()=>nh,"promise",()=>nd,"record",()=>nr,"set",()=>nn,"strictObject",()=>a8,"string",()=>aK,"symbol",()=>aX,"transformer",()=>nc,"tuple",()=>nt,"undefined",()=>aQ,"union",()=>a3,"unknown",()=>a9,"void",()=>a2],17958),function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(x||(x={}));class rz{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let rK=(e,t)=>{if(rV(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new rA(e.common.issues);return this._error=t,this._error}}};function rJ(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??a??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class rW{get description(){return this._def.description}_getType(e){return rE(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:rE(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new r$,ctx:{common:e.parent.common,data:e.data,parsedType:rE(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(rB(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:rE(e)},a=this._parseSync({data:e,path:r.path,parent:r});return rK(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:rE(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return rV(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>rV(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:rE(e)},a=this._parse({data:e,path:r.path,parent:r});return rK(r,await (rB(a)?a:Promise.resolve(a)))}refine(e,t){return this._refinement((r,a)=>{let n=e(r),s=()=>a.addIssue({code:rS.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new aR({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return aj.create(this,this._def)}nullable(){return aM.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return af.create(this)}promise(){return aN.create(this,this._def)}or(e){return ay.create([this,e],this._def)}and(e){return a_.create(this,e,this._def)}transform(e){return new aR({...rJ(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new aP({...rJ(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:k.ZodDefault})}brand(){return new aq({typeName:k.ZodBranded,type:this,...rJ(this._def)})}catch(e){return new aZ({...rJ(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:k.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return aU.create(this,e)}readonly(){return aF.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let rH=/^c[^\s-]{8,}$/i,rY=/^[0-9a-z]+$/,rG=/^[0-9A-HJKMNP-TV-Z]{26}$/i,rX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,rQ=/^[a-z0-9_-]{21}$/i,r0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,r1=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,r9=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,r4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,r2=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,r6=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,r5=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,r8=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,r3=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,r7="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ae=RegExp(`^${r7}$`);function at(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function ar(e){let t=`${r7}T${at(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class aa extends rW{_parse(e){var r,a,n,s;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==rI.string){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.string,received:t.parsedType}),rD}let o=new r$;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(rZ(i=this._getOrReturnCtx(e,i),{code:rS.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(rZ(i=this._getOrReturnCtx(e,i),{code:rS.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?rZ(i,{code:rS.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&rZ(i,{code:rS.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)r9.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"email",code:rS.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)t||(t=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),t.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:rS.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)rX.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:rS.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)rQ.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:rS.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)rH.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:rS.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)rY.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:rS.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)rG.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:rS.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{rZ(i=this._getOrReturnCtx(e,i),{validation:"url",code:rS.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"regex",code:rS.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?ar(l).test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?ae.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${at(l)}$`).test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{code:rS.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?r1.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"duration",code:rS.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(r=e.data,!(("v4"===(a=l.version)||!a)&&r4.test(r)||("v6"===a||!a)&&r6.test(r))&&1&&(rZ(i=this._getOrReturnCtx(e,i),{validation:"ip",code:rS.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!r0.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(rZ(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:rS.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,!(("v4"===(s=l.version)||!s)&&r2.test(n)||("v6"===s||!s)&&r5.test(n))&&1&&(rZ(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:rS.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?r8.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"base64",code:rS.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?r3.test(e.data)||(rZ(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:rS.invalid_string,message:l.message}),o.dirty()):_.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:rS.invalid_string,...x.errToObj(r)})}_addCheck(e){return new aa({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...x.errToObj(e)})}url(e){return this._addCheck({kind:"url",...x.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...x.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...x.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...x.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...x.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...x.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...x.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...x.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...x.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...x.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...x.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...x.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...x.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...x.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...x.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...x.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...x.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...x.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...x.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...x.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...x.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...x.errToObj(t)})}nonempty(e){return this.min(1,x.errToObj(e))}trim(){return new aa({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new aa({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new aa({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}aa.create=e=>new aa({checks:[],typeName:k.ZodString,coerce:e?.coerce??!1,...rJ(e)});class an extends rW{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==rI.number){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.number,received:t.parsedType}),rD}let r=new r$;for(let a of this._def.checks)"int"===a.kind?_.isInteger(e.data)||(rZ(t=this._getOrReturnCtx(e,t),{code:rS.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,a.value)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(rZ(t=this._getOrReturnCtx(e,t),{code:rS.not_finite,message:a.message}),r.dirty()):_.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,a){return new an({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(a)}]})}_addCheck(e){return new an({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:x.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:x.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:x.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:x.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&_.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}an.create=e=>new an({checks:[],typeName:k.ZodNumber,coerce:e?.coerce||!1,...rJ(e)});class as extends rW{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==rI.bigint)return this._getInvalidInput(e);let r=new r$;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):_.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.bigint,received:t.parsedType}),rD}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,a){return new as({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(a)}]})}_addCheck(e){return new as({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}as.create=e=>new as({checks:[],typeName:k.ZodBigInt,coerce:e?.coerce??!1,...rJ(e)});class ai extends rW{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==rI.boolean){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.boolean,received:t.parsedType}),rD}return rU(e.data)}}ai.create=e=>new ai({typeName:k.ZodBoolean,coerce:e?.coerce||!1,...rJ(e)});class ao extends rW{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==rI.date){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.date,received:t.parsedType}),rD}if(Number.isNaN(e.data.getTime()))return rZ(this._getOrReturnCtx(e),{code:rS.invalid_date}),rD;let r=new r$;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(rZ(t=this._getOrReturnCtx(e,t),{code:rS.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):_.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ao({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:x.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:x.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ao.create=e=>new ao({checks:[],coerce:e?.coerce||!1,typeName:k.ZodDate,...rJ(e)});class al extends rW{_parse(e){if(this._getType(e)!==rI.symbol){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.symbol,received:t.parsedType}),rD}return rU(e.data)}}al.create=e=>new al({typeName:k.ZodSymbol,...rJ(e)});class au extends rW{_parse(e){if(this._getType(e)!==rI.undefined){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.undefined,received:t.parsedType}),rD}return rU(e.data)}}au.create=e=>new au({typeName:k.ZodUndefined,...rJ(e)});class ad extends rW{_parse(e){if(this._getType(e)!==rI.null){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.null,received:t.parsedType}),rD}return rU(e.data)}}ad.create=e=>new ad({typeName:k.ZodNull,...rJ(e)});class ac extends rW{constructor(){super(...arguments),this._any=!0}_parse(e){return rU(e.data)}}ac.create=e=>new ac({typeName:k.ZodAny,...rJ(e)});class ap extends rW{constructor(){super(...arguments),this._unknown=!0}_parse(e){return rU(e.data)}}ap.create=e=>new ap({typeName:k.ZodUnknown,...rJ(e)});class am extends rW{_parse(e){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.never,received:t.parsedType}),rD}}am.create=e=>new am({typeName:k.ZodNever,...rJ(e)});class ah extends rW{_parse(e){if(this._getType(e)!==rI.undefined){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.void,received:t.parsedType}),rD}return rU(e.data)}}ah.create=e=>new ah({typeName:k.ZodVoid,...rJ(e)});class af extends rW{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==rI.array)return rZ(t,{code:rS.invalid_type,expected:rI.array,received:t.parsedType}),rD;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(rZ(t,{code:e?rS.too_big:rS.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(rZ(t,{code:rS.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(rZ(t,{code:rS.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new rz(t,e,t.path,r)))).then(e=>r$.mergeArray(r,e));let n=[...t.data].map((e,r)=>a.type._parseSync(new rz(t,e,t.path,r)));return r$.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new af({...this._def,minLength:{value:e,message:x.toString(t)}})}max(e,t){return new af({...this._def,maxLength:{value:e,message:x.toString(t)}})}length(e,t){return new af({...this._def,exactLength:{value:e,message:x.toString(t)}})}nonempty(e){return this.min(1,e)}}af.create=(e,t)=>new af({type:e,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...rJ(t)});class ag extends rW{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=_.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==rI.object){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.object,received:t.parsedType}),rD}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof am&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let i=[];for(let e of n){let t=a[e],n=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new rz(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof am){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(rZ(r,{code:rS.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let a=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new rz(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>r$.mergeObjectSync(t,e)):r$.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return x.errToObj,new ag({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:x.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ag({...this._def,unknownKeys:"strip"})}passthrough(){return new ag({...this._def,unknownKeys:"passthrough"})}extend(e){return new ag({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ag({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ag({...this._def,catchall:e})}pick(e){let t={};for(let r of _.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new ag({...this._def,shape:()=>t})}omit(e){let t={};for(let r of _.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new ag({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ag){let r={};for(let a in t.shape){let n=t.shape[a];r[a]=aj.create(e(n))}return new ag({...t._def,shape:()=>r})}if(t instanceof af)return new af({...t._def,type:e(t.element)});if(t instanceof aj)return aj.create(e(t.unwrap()));if(t instanceof aM)return aM.create(e(t.unwrap()));if(t instanceof aw)return aw.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of _.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new ag({...this._def,shape:()=>t})}required(e){let t={};for(let r of _.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof aj;)e=e._def.innerType;t[r]=e}return new ag({...this._def,shape:()=>t})}keyof(){return aO(_.objectKeys(this.shape))}}ag.create=(e,t)=>new ag({shape:()=>e,unknownKeys:"strip",catchall:am.create(),typeName:k.ZodObject,...rJ(t)}),ag.strictCreate=(e,t)=>new ag({shape:()=>e,unknownKeys:"strict",catchall:am.create(),typeName:k.ZodObject,...rJ(t)}),ag.lazycreate=(e,t)=>new ag({shape:e,unknownKeys:"strip",catchall:am.create(),typeName:k.ZodObject,...rJ(t)});class ay extends rW{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new rA(e.ctx.common.issues));return rZ(t,{code:rS.invalid_union,unionErrors:r}),rD});{let e,a=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=a.map(e=>new rA(e));return rZ(t,{code:rS.invalid_union,unionErrors:n}),rD}}get options(){return this._def.options}}ay.create=(e,t)=>new ay({options:e,typeName:k.ZodUnion,...rJ(t)});let av=e=>{if(e instanceof aE)return av(e.schema);if(e instanceof aR)return av(e.innerType());if(e instanceof aS)return[e.value];if(e instanceof aA)return e.options;if(e instanceof aC)return _.objectValues(e.enum);else if(e instanceof aP)return av(e._def.innerType);else if(e instanceof au)return[void 0];else if(e instanceof ad)return[null];else if(e instanceof aj)return[void 0,...av(e.unwrap())];else if(e instanceof aM)return[null,...av(e.unwrap())];else if(e instanceof aq)return av(e.unwrap());else if(e instanceof aF)return av(e.unwrap());else if(e instanceof aZ)return av(e._def.innerType);else return[]};class ab extends rW{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==rI.object)return rZ(t,{code:rS.invalid_type,expected:rI.object,received:t.parsedType}),rD;let r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(rZ(t,{code:rS.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),rD)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=av(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(a.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new ab({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...rJ(r)})}}class a_ extends rW{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(rF(e)||rF(a))return rD;let n=function e(t,r){let a=rE(t),n=rE(r);if(t===r)return{valid:!0,data:t};if(a===rI.object&&n===rI.object){let a=_.objectKeys(r),n=_.objectKeys(t).filter(e=>-1!==a.indexOf(e)),s={...t,...r};for(let a of n){let n=e(t[a],r[a]);if(!n.valid)return{valid:!1};s[a]=n.data}return{valid:!0,data:s}}if(a===rI.array&&n===rI.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};a.push(s.data)}return{valid:!0,data:a}}if(a===rI.date&&n===rI.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,a.value);return n.valid?((rL(e)||rL(a))&&t.dirty(),{status:t.value,value:n.data}):(rZ(r,{code:rS.invalid_intersection_types}),rD)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}a_.create=(e,t,r)=>new a_({left:e,right:t,typeName:k.ZodIntersection,...rJ(r)});class aw extends rW{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==rI.array)return rZ(r,{code:rS.invalid_type,expected:rI.array,received:r.parsedType}),rD;if(r.data.length<this._def.items.length)return rZ(r,{code:rS.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),rD;!this._def.rest&&r.data.length>this._def.items.length&&(rZ(r,{code:rS.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new rz(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>r$.mergeArray(t,e)):r$.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new aw({...this._def,rest:e})}}aw.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new aw({items:e,typeName:k.ZodTuple,rest:null,...rJ(t)})};class ax extends rW{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==rI.object)return rZ(r,{code:rS.invalid_type,expected:rI.object,received:r.parsedType}),rD;let a=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)a.push({key:n._parse(new rz(r,e,r.path,e)),value:s._parse(new rz(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?r$.mergeObjectAsync(t,a):r$.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ax(t instanceof rW?{keyType:e,valueType:t,typeName:k.ZodRecord,...rJ(r)}:{keyType:aa.create(),valueType:e,typeName:k.ZodRecord,...rJ(t)})}}class ak extends rW{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==rI.map)return rZ(r,{code:rS.invalid_type,expected:rI.map,received:r.parsedType}),rD;let a=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:a._parse(new rz(r,e,r.path,[s,"key"])),value:n._parse(new rz(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return rD;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return rD;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}ak.create=(e,t,r)=>new ak({valueType:t,keyType:e,typeName:k.ZodMap,...rJ(r)});class aT extends rW{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==rI.set)return rZ(r,{code:rS.invalid_type,expected:rI.set,received:r.parsedType}),rD;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(rZ(r,{code:rS.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(rZ(r,{code:rS.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let a of e){if("aborted"===a.status)return rD;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>n._parse(new rz(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>s(e)):s(i)}min(e,t){return new aT({...this._def,minSize:{value:e,message:x.toString(t)}})}max(e,t){return new aT({...this._def,maxSize:{value:e,message:x.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}aT.create=(e,t)=>new aT({valueType:e,minSize:null,maxSize:null,typeName:k.ZodSet,...rJ(t)});class aI extends rW{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==rI.function)return rZ(t,{code:rS.invalid_type,expected:rI.function,received:t.parsedType}),rD;function r(e,r){return rM({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,rN,rC].filter(e=>!!e),issueData:{code:rS.invalid_arguments,argumentsError:r}})}function a(e,r){return rM({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,rN,rC].filter(e=>!!e),issueData:{code:rS.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof aN){let e=this;return rU(async function(...t){let i=new rA([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(a(l,e)),i})})}{let e=this;return rU(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new rA([r(t,i.error)]);let o=Reflect.apply(s,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new rA([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new aI({...this._def,args:aw.create(e).rest(ap.create())})}returns(e){return new aI({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new aI({args:e||aw.create([]).rest(ap.create()),returns:t||ap.create(),typeName:k.ZodFunction,...rJ(r)})}}class aE extends rW{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}aE.create=(e,t)=>new aE({getter:e,typeName:k.ZodLazy,...rJ(t)});class aS extends rW{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return rZ(t,{received:t.data,code:rS.invalid_literal,expected:this._def.value}),rD}return{status:"valid",value:e.data}}get value(){return this._def.value}}function aO(e,t){return new aA({values:e,typeName:k.ZodEnum,...rJ(t)})}aS.create=(e,t)=>new aS({value:e,typeName:k.ZodLiteral,...rJ(t)});class aA extends rW{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return rZ(t,{expected:_.joinValues(r),received:t.parsedType,code:rS.invalid_type}),rD}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return rZ(t,{received:t.data,code:rS.invalid_enum_value,options:r}),rD}return rU(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return aA.create(e,{...this._def,...t})}exclude(e,t=this._def){return aA.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}aA.create=aO;class aC extends rW{_parse(e){let t=_.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==rI.string&&r.parsedType!==rI.number){let e=_.objectValues(t);return rZ(r,{expected:_.joinValues(e),received:r.parsedType,code:rS.invalid_type}),rD}if(this._cache||(this._cache=new Set(_.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=_.objectValues(t);return rZ(r,{received:r.data,code:rS.invalid_enum_value,options:e}),rD}return rU(e.data)}get enum(){return this._def.values}}aC.create=(e,t)=>new aC({values:e,typeName:k.ZodNativeEnum,...rJ(t)});class aN extends rW{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==rI.promise&&!1===t.common.async?(rZ(t,{code:rS.invalid_type,expected:rI.promise,received:t.parsedType}),rD):rU((t.parsedType===rI.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}aN.create=(e,t)=>new aN({type:e,typeName:k.ZodPromise,...rJ(t)});class aR extends rW{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{rZ(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){let e=a.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return rD;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?rD:"dirty"===a.status||"dirty"===t.value?rq(a.value):a});{if("aborted"===t.value)return rD;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?rD:"dirty"===a.status||"dirty"===t.value?rq(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?rD:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?rD:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>rV(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):rD);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!rV(e))return rD;let s=a.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}_.assertNever(a)}}aR.create=(e,t,r)=>new aR({schema:e,typeName:k.ZodEffects,effect:t,...rJ(r)}),aR.createWithPreprocess=(e,t,r)=>new aR({schema:t,effect:{type:"preprocess",transform:e},typeName:k.ZodEffects,...rJ(r)});class aj extends rW{_parse(e){return this._getType(e)===rI.undefined?rU(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}aj.create=(e,t)=>new aj({innerType:e,typeName:k.ZodOptional,...rJ(t)});class aM extends rW{_parse(e){return this._getType(e)===rI.null?rU(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}aM.create=(e,t)=>new aM({innerType:e,typeName:k.ZodNullable,...rJ(t)});class aP extends rW{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===rI.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}aP.create=(e,t)=>new aP({innerType:e,typeName:k.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...rJ(t)});class aZ extends rW{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return rB(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new rA(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new rA(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}aZ.create=(e,t)=>new aZ({innerType:e,typeName:k.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...rJ(t)});class a$ extends rW{_parse(e){if(this._getType(e)!==rI.nan){let t=this._getOrReturnCtx(e);return rZ(t,{code:rS.invalid_type,expected:rI.nan,received:t.parsedType}),rD}return{status:"valid",value:e.data}}}a$.create=e=>new a$({typeName:k.ZodNaN,...rJ(e)});let aD=Symbol("zod_brand");class aq extends rW{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class aU extends rW{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?rD:"dirty"===e.status?(t.dirty(),rq(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?rD:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new aU({in:e,out:t,typeName:k.ZodPipeline})}}class aF extends rW{_parse(e){let t=this._def.innerType._parse(e),r=e=>(rV(e)&&(e.value=Object.freeze(e.value)),e);return rB(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function aL(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function aV(e,t={},r){return e?ac.create().superRefine((a,n)=>{let s=e(a);if(s instanceof Promise)return s.then(e=>{if(!e){let e=aL(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=aL(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):ac.create()}aF.create=(e,t)=>new aF({innerType:e,typeName:k.ZodReadonly,...rJ(t)});let aB={object:ag.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(k||(k={}));let az=(e,t={message:`Input not instance of ${e.name}`})=>aV(t=>t instanceof e,t),aK=aa.create,aJ=an.create,aW=a$.create,aH=as.create,aY=ai.create,aG=ao.create,aX=al.create,aQ=au.create,a0=ad.create,a1=ac.create,a9=ap.create,a4=am.create,a2=ah.create,a6=af.create,a5=ag.create,a8=ag.strictCreate,a3=ay.create,a7=ab.create,ne=a_.create,nt=aw.create,nr=ax.create,na=ak.create,nn=aT.create,ns=aI.create,ni=aE.create,no=aS.create,nl=aA.create,nu=aC.create,nd=aN.create,nc=aR.create,np=aj.create,nm=aM.create,nh=aR.createWithPreprocess,nf=aU.create,ng=()=>aK().optional(),ny=()=>aJ().optional(),nv=()=>aY().optional(),nb={string:e=>aa.create({...e,coerce:!0}),number:e=>an.create({...e,coerce:!0}),boolean:e=>ai.create({...e,coerce:!0}),bigint:e=>as.create({...e,coerce:!0}),date:e=>ao.create({...e,coerce:!0})},n_=rD;function nw(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function nx(e,t){if(null==e)return Promise.resolve();let r=null==t?void 0:t.abortSignal;return new Promise((t,a)=>{if(null==r?void 0:r.aborted)return void a(nk());let n=setTimeout(()=>{s(),t()},e),s=()=>{clearTimeout(n),null==r||r.removeEventListener("abort",i)},i=()=>{s(),a(nk())};null==r||r.addEventListener("abort",i)})}function nk(){return new DOMException("Delay was aborted","AbortError")}function nT(e){return Object.fromEntries([...e.headers])}e.s(["BRAND",()=>aD,"DIRTY",()=>rq,"EMPTY_PATH",()=>rP,"INVALID",()=>rD,"NEVER",()=>n_,"OK",()=>rU,"ParseStatus",()=>r$,"Schema",()=>rW,"ZodAny",()=>ac,"ZodArray",()=>af,"ZodBigInt",()=>as,"ZodBoolean",()=>ai,"ZodBranded",()=>aq,"ZodCatch",()=>aZ,"ZodDate",()=>ao,"ZodDefault",()=>aP,"ZodDiscriminatedUnion",()=>ab,"ZodEffects",()=>aR,"ZodEnum",()=>aA,"ZodError",()=>rA,"ZodFirstPartyTypeKind",()=>k,"ZodFunction",()=>aI,"ZodIntersection",()=>a_,"ZodIssueCode",()=>rS,"ZodLazy",()=>aE,"ZodLiteral",()=>aS,"ZodMap",()=>ak,"ZodNaN",()=>a$,"ZodNativeEnum",()=>aC,"ZodNever",()=>am,"ZodNull",()=>ad,"ZodNullable",()=>aM,"ZodNumber",()=>an,"ZodObject",()=>ag,"ZodOptional",()=>aj,"ZodParsedType",()=>rI,"ZodPipeline",()=>aU,"ZodPromise",()=>aN,"ZodReadonly",()=>aF,"ZodRecord",()=>ax,"ZodSchema",()=>rW,"ZodSet",()=>aT,"ZodString",()=>aa,"ZodSymbol",()=>al,"ZodTransformer",()=>aR,"ZodTuple",()=>aw,"ZodType",()=>rW,"ZodUndefined",()=>au,"ZodUnion",()=>ay,"ZodUnknown",()=>ap,"ZodVoid",()=>ah,"addIssueToContext",()=>rZ,"any",()=>a1,"array",()=>a6,"bigint",()=>aH,"boolean",()=>aY,"coerce",()=>nb,"custom",()=>aV,"date",()=>aG,"datetimeRegex",()=>ar,"defaultErrorMap",()=>rC,"discriminatedUnion",()=>a7,"effect",()=>nc,"enum",()=>nl,"function",()=>ns,"getErrorMap",()=>rj,"getParsedType",()=>rE,"instanceof",()=>az,"intersection",()=>ne,"isAborted",()=>rF,"isAsync",()=>rB,"isDirty",()=>rL,"isValid",()=>rV,"late",()=>aB,"lazy",()=>ni,"literal",()=>no,"makeIssue",()=>rM,"map",()=>na,"nan",()=>aW,"nativeEnum",()=>nu,"never",()=>a4,"null",()=>a0,"nullable",()=>nm,"number",()=>aJ,"object",()=>a5,"objectUtil",()=>w,"oboolean",()=>nv,"onumber",()=>ny,"optional",()=>np,"ostring",()=>ng,"pipeline",()=>nf,"preprocess",()=>nh,"promise",()=>nd,"quotelessJson",()=>rO,"record",()=>nr,"set",()=>nn,"setErrorMap",()=>rR,"strictObject",()=>a8,"string",()=>aK,"symbol",()=>aX,"transformer",()=>nc,"tuple",()=>nt,"undefined",()=>aQ,"union",()=>a3,"unknown",()=>a9,"util",()=>_,"void",()=>a2],35907),e.i(54033),e.s(["defaultErrorMap",()=>rC,"getErrorMap",()=>rj,"setErrorMap",()=>rR],76733),e.i(85676),e.i(76733),e.i(84488),e.i(91316),e.i(42944),e.i(17958),e.i(15235),e.i(35907);var nI=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let n=()=>{let e=r.length,a=Array(t);for(let n=0;n<t;n++)a[n]=r[Math.random()*e|0];return a.join("")};if(null==e)return n;if(r.includes(a))throw new rn({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return()=>`${e}${a}${n()}`},nE=nI();function nS(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}function nO(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var nA=["fetch failed","failed to fetch"];function nC({error:e,url:t,requestBodyValues:r}){if(nO(e))return e;if(e instanceof TypeError&&nA.includes(e.message.toLowerCase())){let a=e.cause;if(null!=a)return new t6({message:`Cannot connect to API: ${a.message}`,cause:a,url:t,requestBodyValues:r,isRetryable:!0})}return e}function nN(e=globalThis){var t,r,a;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(a=null==(r=e.process)?void 0:r.versions)?void 0:a.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function nR(e,...t){let r=new Headers(function(e){if(null==e)return{};let t={};if(e instanceof Headers)e.forEach((e,r)=>{t[r.toLowerCase()]=e});else for(let[r,a]of(Array.isArray(e)||(e=Object.entries(e)),e))null!=a&&(t[r.toLowerCase()]=a);return t}(e)),a=r.get("user-agent")||"";return r.set("user-agent",[a,...t].filter(Boolean).join(" ")),Object.fromEntries(r.entries())}var nj="3.0.16",nM=()=>globalThis.fetch,nP=async({url:e,headers:t={},successfulResponseHandler:r,failedResponseHandler:a,abortSignal:n,fetch:s=nM()})=>{try{let i=await s(e,{method:"GET",headers:nR(t,`ai-sdk/provider-utils/${nj}`,nN()),signal:n}),o=nT(i);if(!i.ok){let t;try{t=await a({response:i,url:e,requestBodyValues:{}})}catch(t){if(nO(t)||t6.isInstance(t))throw t;throw new t6({message:"Failed to process error response",cause:t,statusCode:i.status,url:e,responseHeaders:o,requestBodyValues:{}})}throw t.value}try{return await r({response:i,url:e,requestBodyValues:{}})}catch(t){if(t instanceof Error&&(nO(t)||t6.isInstance(t)))throw t;throw new t6({message:"Failed to process successful response",cause:t,statusCode:i.status,url:e,responseHeaders:o,requestBodyValues:{}})}}catch(t){throw nC({error:t,url:e,requestBodyValues:{}})}};function nZ({settingValue:e,environmentVariableName:t}){return"string"==typeof e?e:null!=e||"undefined"==typeof process?void 0:null!=(e=process.env[t])&&"string"==typeof e?e:void 0}var n$=/"__proto__"\s*:/,nD=/"constructor"\s*:/;function nq(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{let t=JSON.parse(e);return null===t||"object"!=typeof t||!1===n$.test(e)&&!1===nD.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let r of(t=[],e)){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in r){let a=r[e];a&&"object"==typeof a&&t.push(a)}}}return e}(t)}finally{Error.stackTraceLimit=t}}var nU=Symbol.for("vercel.ai.validator");function nF(e){let t;return()=>(null==t&&(t=e()),t)}async function nL({value:e,schema:t}){let r=await nV({value:e,schema:t});if(!r.success)throw r_.wrap({value:e,cause:r.error});return r.value}async function nV({value:e,schema:t}){var r;let a="object"==typeof t&&null!==t&&nU in t&&!0===t[nU]&&"validate"in t?t:"function"==typeof t?t():(r=t,{[nU]:!0,validate:async e=>{let t=await r["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new r_({value:e,cause:t.issues})}}});try{if(null==a.validate)return{success:!0,value:e,rawValue:e};let t=await a.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:r_.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:r_.wrap({value:e,cause:t}),rawValue:e}}}async function nB({text:e,schema:t}){try{let r=nq(e);if(null==t)return r;return nL({value:r,schema:t})}catch(t){if(rp.isInstance(t)||r_.isInstance(t))throw t;throw new rp({text:e,cause:t})}}async function nz({text:e,schema:t}){try{let r=nq(e);if(null==t)return{success:!0,value:r,rawValue:r};return await nV({value:r,schema:t})}catch(t){return{success:!1,error:rp.isInstance(t)?t:new rp({text:e,cause:t}),rawValue:void 0}}}var nK=()=>globalThis.fetch,nJ=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i})=>nW({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i}),nW=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:s,fetch:i=nK()})=>{try{let o=await i(e,{method:"POST",headers:nR(t,`ai-sdk/provider-utils/${nj}`,nN()),body:r.content,signal:s}),l=nT(o);if(!o.ok){let t;try{t=await n({response:o,url:e,requestBodyValues:r.values})}catch(t){if(nO(t)||t6.isInstance(t))throw t;throw new t6({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(nO(t)||t6.isInstance(t)))throw t;throw new t6({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){throw nC({error:t,url:e,requestBodyValues:r.values})}};async function nH(e){return"function"==typeof e&&(e=e()),Promise.resolve(e)}var nY=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:s})=>{let i=await a.text(),o=nT(a);if(""===i.trim())return{responseHeaders:o,value:new t6({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=await nB({text:i,schema:e});return{responseHeaders:o,value:new t6({message:t(l),url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new t6({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}},nG=e=>async({response:t,url:r,requestBodyValues:a})=>{let n=await t.text(),s=await nz({text:n,schema:e}),i=nT(t);if(!s.success)throw new t6({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:i,value:s.value,rawValue:s.rawValue}},nX=Symbol("Let zodToJsonSchema decide on which parser to use"),nQ={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function n0(e,t){return st(e.type._def,t)}var n1=void 0,n9={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===n1&&(n1=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n1),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function n4(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":r.minLength="number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value;break;case"max":r.maxLength="number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value;break;case"email":switch(t.emailStrategy){case"format:email":n5(r,"email",a.message,t);break;case"format:idn-email":n5(r,"idn-email",a.message,t);break;case"pattern:zod":n8(r,n9.email,a.message,t)}break;case"url":n5(r,"uri",a.message,t);break;case"uuid":n5(r,"uuid",a.message,t);break;case"regex":n8(r,a.regex,a.message,t);break;case"cuid":n8(r,n9.cuid,a.message,t);break;case"cuid2":n8(r,n9.cuid2,a.message,t);break;case"startsWith":n8(r,RegExp(`^${n2(a.value,t)}`),a.message,t);break;case"endsWith":n8(r,RegExp(`${n2(a.value,t)}$`),a.message,t);break;case"datetime":n5(r,"date-time",a.message,t);break;case"date":n5(r,"date",a.message,t);break;case"time":n5(r,"time",a.message,t);break;case"duration":n5(r,"duration",a.message,t);break;case"length":r.minLength="number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,r.maxLength="number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value;break;case"includes":n8(r,RegExp(n2(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&n5(r,"ipv4",a.message,t),"v4"!==a.version&&n5(r,"ipv6",a.message,t);break;case"base64url":n8(r,n9.base64url,a.message,t);break;case"jwt":n8(r,n9.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&n8(r,n9.ipv4Cidr,a.message,t),"v4"!==a.version&&n8(r,n9.ipv6Cidr,a.message,t);break;case"emoji":n8(r,n9.emoji(),a.message,t);break;case"ulid":n8(r,n9.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":n5(r,"binary",a.message,t);break;case"contentEncoding:base64":r.contentEncoding="base64";break;case"pattern:zod":n8(r,n9.base64,a.message,t)}break;case"nanoid":n8(r,n9.nanoid,a.message,t)}return r}function n2(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)n6.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}var n6=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function n5(e,t,r,a){var n;e.format||(null==(n=e.anyOf)?void 0:n.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):e.format=t}function n8(e,t,r,a){var n;e.pattern||(null==(n=e.allOf)?void 0:n.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:n3(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):e.pattern=n3(t,a)}function n3(e,t){var r;if(!t.applyRegexFlags||!e.flags)return e.source;let a={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},n=a.i?e.source.toLowerCase():e.source,s="",i=!1,o=!1,l=!1;for(let e=0;e<n.length;e++){if(i){s+=n[e],i=!1;continue}if(a.i){if(o){if(n[e].match(/[a-z]/)){l?(s+=n[e],s+=`${n[e-2]}-${n[e]}`.toUpperCase(),l=!1):"-"===n[e+1]&&(null==(r=n[e+2])?void 0:r.match(/[a-z]/))?(s+=n[e],l=!0):s+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){s+=`[${n[e]}${n[e].toUpperCase()}]`;continue}}if(a.m){if("^"===n[e]){s+=`(^|(?<=[\r
]))`;continue}else if("$"===n[e]){s+=`($|(?=[\r
]))`;continue}}if(a.s&&"."===n[e]){s+=o?`${n[e]}\r
`:`[${n[e]}\r
]`;continue}s+=n[e],"\\"===n[e]?i=!0:o&&"]"===n[e]?o=!1:o||"["!==n[e]||(o=!0)}try{new RegExp(s)}catch(r){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function n7(e,t){var r,a,n,s,i,o;let l={type:"object",additionalProperties:null!=(r=st(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?r:t.allowedAdditionalProperties};if((null==(a=e.keyType)?void 0:a._def.typeName)===k.ZodString&&(null==(n=e.keyType._def.checks)?void 0:n.length)){let{type:r,...a}=n4(e.keyType._def,t);return{...l,propertyNames:a}}if((null==(s=e.keyType)?void 0:s._def.typeName)===k.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(i=e.keyType)?void 0:i._def.typeName)===k.ZodBranded&&e.keyType._def.type._def.typeName===k.ZodString&&(null==(o=e.keyType._def.type._def.checks)?void 0:o.length)){let{type:r,...a}=n0(e.keyType._def,t);return{...l,propertyNames:a}}return l}var se={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function st(e,t,r=!1){var a;let n=t.seen.get(e);if(t.override){let s=null==(a=t.override)?void 0:a.call(t,e,t,n,r);if(s!==nX)return s}if(n&&!r){let e=sr(n,t);if(void 0!==e)return e}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let i=((e,t,r)=>{switch(t){case k.ZodString:return n4(e,r);case k.ZodNumber:var a,n,s,i,o,l,u=e;let d={type:"number"};if(!u.checks)return d;for(let e of u.checks)switch(e.kind){case"int":d.type="integer";break;case"min":e.inclusive?d.minimum=e.value:d.exclusiveMinimum=e.value;break;case"max":e.inclusive?d.maximum=e.value:d.exclusiveMaximum=e.value;break;case"multipleOf":d.multipleOf=e.value}return d;case k.ZodObject:return function(e,t){let r={type:"object",properties:{}},a=[],n=e.shape();for(let e in n){let s=n[e];if(void 0===s||void 0===s._def)continue;let i=function(e){try{return e.isOptional()}catch(e){return!0}}(s),o=st(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==o&&(r.properties[e]=o,i||a.push(e))}a.length&&(r.required=a);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return st(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(r.additionalProperties=s),r}(e,r);case k.ZodBigInt:var c=e;let p={type:"integer",format:"int64"};if(!c.checks)return p;for(let e of c.checks)switch(e.kind){case"min":e.inclusive?p.minimum=e.value:p.exclusiveMinimum=e.value;break;case"max":e.inclusive?p.maximum=e.value:p.exclusiveMaximum=e.value;break;case"multipleOf":p.multipleOf=e.value}return p;case k.ZodBoolean:return{type:"boolean"};case k.ZodDate:return function e(t,r,a){let n=null!=a?a:r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,n)=>e(t,r,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var s=t;let i={type:"integer",format:"unix-time"};for(let e of s.checks)switch(e.kind){case"min":i.minimum=e.value;break;case"max":i.maximum=e.value}return i}}(e,r);case k.ZodUndefined:return{not:{}};case k.ZodNull:return{type:"null"};case k.ZodArray:var m,h,f,g=e,y=r;let v={type:"array"};return(null==(m=g.type)?void 0:m._def)&&(null==(f=null==(h=g.type)?void 0:h._def)?void 0:f.typeName)!==k.ZodAny&&(v.items=st(g.type._def,{...y,currentPath:[...y.currentPath,"items"]})),g.minLength&&(v.minItems=g.minLength.value),g.maxLength&&(v.maxItems=g.maxLength.value),g.exactLength&&(v.minItems=g.exactLength.value,v.maxItems=g.exactLength.value),v;case k.ZodUnion:case k.ZodDiscriminatedUnion:return function(e,t){let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in se&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=se[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};var a=e,n=t;let s=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((e,t)=>st(e._def,{...n,currentPath:[...n.currentPath,"anyOf",`${t}`]})).filter(e=>!!e&&(!n.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return s.length?{anyOf:s}:void 0}(e,r);case k.ZodIntersection:var b=e,_=r;let w=[st(b.left._def,{..._,currentPath:[..._.currentPath,"allOf","0"]}),st(b.right._def,{..._,currentPath:[..._.currentPath,"allOf","1"]})].filter(e=>!!e),x=[];return w.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)x.push(...e.allOf);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}x.push(t)}}),x.length?{allOf:x}:void 0;case k.ZodTuple:return j=e,M=r,j.rest?{type:"array",minItems:j.items.length,items:j.items.map((e,t)=>st(e._def,{...M,currentPath:[...M.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:st(j.rest._def,{...M,currentPath:[...M.currentPath,"additionalItems"]})}:{type:"array",minItems:j.items.length,maxItems:j.items.length,items:j.items.map((e,t)=>st(e._def,{...M,currentPath:[...M.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case k.ZodRecord:return n7(e,r);case k.ZodLiteral:var T=e;let I=typeof T.value;return"bigint"!==I&&"number"!==I&&"boolean"!==I&&"string"!==I?{type:Array.isArray(T.value)?"array":"object"}:{type:"bigint"===I?"integer":I,const:T.value};case k.ZodEnum:return{type:"string",enum:Array.from(e.values)};case k.ZodNativeEnum:var E=e;let S=E.values,O=Object.keys(E.values).filter(e=>"number"!=typeof S[S[e]]).map(e=>S[e]),A=Array.from(new Set(O.map(e=>typeof e)));return{type:1===A.length?"string"===A[0]?"string":"number":["string","number"],enum:O};case k.ZodNullable:var C=e,N=r;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(C.innerType._def.typeName)&&(!C.innerType._def.checks||!C.innerType._def.checks.length))return{type:[se[C.innerType._def.typeName],"null"]};let R=st(C.innerType._def,{...N,currentPath:[...N.currentPath,"anyOf","0"]});return R&&{anyOf:[R,{type:"null"}]};case k.ZodOptional:var j,M,P,Z=e,$=r;if($.currentPath.toString()===(null==(P=$.propertyPath)?void 0:P.toString()))return st(Z.innerType._def,$);let D=st(Z.innerType._def,{...$,currentPath:[...$.currentPath,"anyOf","1"]});return D?{anyOf:[{not:{}},D]}:{};case k.ZodMap:return a=e,"record"===(n=r).mapStrategy?n7(a,n):{type:"array",maxItems:125,items:{type:"array",items:[st(a.keyType._def,{...n,currentPath:[...n.currentPath,"items","items","0"]})||{},st(a.valueType._def,{...n,currentPath:[...n.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case k.ZodSet:var q=e,U=r;let F={type:"array",uniqueItems:!0,items:st(q.valueType._def,{...U,currentPath:[...U.currentPath,"items"]})};return q.minSize&&(F.minItems=q.minSize.value),q.maxSize&&(F.maxItems=q.maxSize.value),F;case k.ZodLazy:return()=>e.getter()._def;case k.ZodPromise:return st(e.type._def,r);case k.ZodNaN:case k.ZodNever:return{not:{}};case k.ZodEffects:return s=e,"input"===(i=r).effectStrategy?st(s.schema._def,i):{};case k.ZodAny:case k.ZodUnknown:return{};case k.ZodDefault:return o=e,l=r,{...st(o.innerType._def,l),default:o.defaultValue()};case k.ZodBranded:return n0(e,r);case k.ZodReadonly:case k.ZodCatch:return st(e.innerType._def,r);case k.ZodPipeline:var L=e,V=r;if("input"===V.pipeStrategy)return st(L.in._def,V);if("output"===V.pipeStrategy)return st(L.out._def,V);let B=st(L.in._def,{...V,currentPath:[...V.currentPath,"allOf","0"]}),z=st(L.out._def,{...V,currentPath:[...V.currentPath,"allOf",B?"1":"0"]});return{allOf:[B,z].filter(e=>void 0!==e)};case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:default:return}})(e,e.typeName,t),o="function"==typeof i?st(i(),t):i;if(o&&sa(e,t,o),t.postProcess){let r=t.postProcess(o,e,t);return s.jsonSchema=o,r}return s.jsonSchema=o,o}var sr=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:((e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")})(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},sa=(e,t,r)=>(e.description&&(r.description=e.description),r);function sn(e,t){var r,a;if("_zod"in e){let a=null!=(r=null==t?void 0:t.useReferences)&&r;return si(()=>ed.toJSONSchema(e,{target:"draft-7",io:"output",reused:a?"ref":"inline"}),{validate:async t=>{let r=await rT.safeParseAsync(e,t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}let n=null!=(a=null==t?void 0:t.useReferences)&&a;return si(()=>((e,t)=>{var r;let a=(e=>{let t,r="string"==typeof(t=e)?{...nQ,name:t}:{...nQ,...t},a=void 0!==r.name?[...r.basePath,r.definitionPath,r.name]:r.basePath;return{...r,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}})(t),n="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>{var n;return{...e,[t]:null!=(n=st(r._def,{...a,currentPath:[...a.basePath,a.definitionPath,t]},!0))?n:{}}},{}):void 0,s="string"==typeof t?t:(null==t?void 0:t.nameStrategy)==="title"||null==t?void 0:t.name,i=null!=(r=st(e._def,void 0===s?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1))?r:{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(i.title=o);let l=void 0===s?n?{...i,[a.definitionPath]:n}:i:{$ref:[..."relative"===a.$refStrategy?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...n,[s]:i}};return l.$schema="http://json-schema.org/draft-07/schema#",l})(e,{$refStrategy:n?"root":"none"}),{validate:async t=>{let r=await e.safeParseAsync(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var ss=Symbol.for("vercel.ai.schema");function si(e,{validate:t}={}){return{[ss]:!0,_type:void 0,[nU]:!0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}function so(e){return null==e?si({properties:{},additionalProperties:!1}):"object"==typeof e&&null!==e&&ss in e&&!0===e[ss]&&"jsonSchema"in e&&"validate"in e?e:"function"==typeof e?e():sn(e)}var{btoa:sl,atob:su}=globalThis;function sd(e){let t=su(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function sc(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return sl(t)}async function*sp({execute:e,input:t,options:r}){let a=e(t,r);if(null!=a&&"function"==typeof a[Symbol.asyncIterator]){let e;for await(let t of a)e=t,yield{type:"preliminary",output:t};yield{type:"final",output:e}}else yield{type:"final",output:await a}}var ep=ed,sm=e.i(90536),sh=Symbol.for("vercel.ai.gateway.error"),sf=class e extends(I=Error,T=sh,I){constructor({message:e,statusCode:t=500,cause:r}){super(e),this[T]=!0,this.statusCode=t,this.cause=r}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return"object"==typeof e&&null!==e&&sh in e&&!0===e[sh]}},sg="GatewayAuthenticationError",sy=Symbol.for(`vercel.ai.gateway.error.${sg}`),sv=class e extends(S=sf,E=sy,S){constructor({message:e="Authentication failed",statusCode:t=401,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[E]=!0,this.name=sg,this.type="authentication_error"}static isInstance(e){return sf.hasMarker(e)&&sy in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:r,message:a="Authentication failed",statusCode:n=401,cause:s}){return new e({message:t?`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,statusCode:n,cause:s})}},sb="GatewayInvalidRequestError",s_=Symbol.for(`vercel.ai.gateway.error.${sb}`),sw=class extends(A=sf,O=s_,A){constructor({message:e="Invalid request",statusCode:t=400,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[O]=!0,this.name=sb,this.type="invalid_request_error"}static isInstance(e){return sf.hasMarker(e)&&s_ in e}},sx="GatewayRateLimitError",sk=Symbol.for(`vercel.ai.gateway.error.${sx}`),sT=class extends(N=sf,C=sk,N){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[C]=!0,this.name=sx,this.type="rate_limit_exceeded"}static isInstance(e){return sf.hasMarker(e)&&sk in e}},sI="GatewayModelNotFoundError",sE=Symbol.for(`vercel.ai.gateway.error.${sI}`),sS=nF(()=>sn(ep.object({modelId:ep.string()}))),sO=class extends(j=sf,R=sE,j){constructor({message:e="Model not found",statusCode:t=404,modelId:r,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[R]=!0,this.name=sI,this.type="model_not_found",this.modelId=r}static isInstance(e){return sf.hasMarker(e)&&sE in e}},sA="GatewayInternalServerError",sC=Symbol.for(`vercel.ai.gateway.error.${sA}`),sN=class extends(P=sf,M=sC,P){constructor({message:e="Internal server error",statusCode:t=500,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[M]=!0,this.name=sA,this.type="internal_server_error"}static isInstance(e){return sf.hasMarker(e)&&sC in e}},sR="GatewayResponseError",sj=Symbol.for(`vercel.ai.gateway.error.${sR}`),sM=class extends($=sf,Z=sj,$){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:r,validationError:a,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Z]=!0,this.name=sR,this.type="response_error",this.response=r,this.validationError=a}static isInstance(e){return sf.hasMarker(e)&&sj in e}};async function sP({response:e,statusCode:t,defaultMessage:r="Gateway request failed",cause:a,authMethod:n}){let s=await nV({value:e,schema:sZ});if(!s.success)return new sM({message:`Invalid error response format: ${r}`,statusCode:t,response:e,validationError:s.error,cause:a});let i=s.value,o=i.error.type,l=i.error.message;switch(o){case"authentication_error":return sv.createContextualError({apiKeyProvided:"api-key"===n,oidcTokenProvided:"oidc"===n,statusCode:t,cause:a});case"invalid_request_error":return new sw({message:l,statusCode:t,cause:a});case"rate_limit_exceeded":return new sT({message:l,statusCode:t,cause:a});case"model_not_found":{let e=await nV({value:i.error.param,schema:sS});return new sO({message:l,statusCode:t,modelId:e.success?e.value.modelId:void 0,cause:a})}default:return new sN({message:l,statusCode:t,cause:a})}}var sZ=nF(()=>sn(ep.object({error:ep.object({message:ep.string(),type:ep.string().nullish(),param:ep.unknown().nullish(),code:ep.union([ep.string(),ep.number()]).nullish()})})));function s$(e,t){var r;return sf.isInstance(e)?e:t6.isInstance(e)?sP({response:function(e){if(void 0!==e.data)return e.data;if(null!=e.responseBody)try{return JSON.parse(e.responseBody)}catch(t){return e.responseBody}return{}}(e),statusCode:null!=(r=e.statusCode)?r:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):sP({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}var sD="ai-gateway-auth-method";async function sq(e){let t=await nV({value:e[sD],schema:sU});return t.success?t.value:void 0}var sU=nF(()=>sn(ep.union([ep.literal("api-key"),ep.literal("oidc")]))),sF=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await nP({url:`${this.config.baseURL}/config`,headers:await nH(this.config.headers()),successfulResponseHandler:nG(sL),failedResponseHandler:nY({errorSchema:ep.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw await s$(e)}}async getCredits(){try{let e=new URL(this.config.baseURL),{value:t}=await nP({url:`${e.origin}/v1/credits`,headers:await nH(this.config.headers()),successfulResponseHandler:nG(sV),failedResponseHandler:nY({errorSchema:ep.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return t}catch(e){throw await s$(e)}}},sL=nF(()=>sn(ep.object({models:ep.array(ep.object({id:ep.string(),name:ep.string(),description:ep.string().nullish(),pricing:ep.object({input:ep.string(),output:ep.string(),input_cache_read:ep.string().nullish(),input_cache_write:ep.string().nullish()}).transform(({input:e,output:t,input_cache_read:r,input_cache_write:a})=>({input:e,output:t,...r?{cachedInputTokens:r}:{},...a?{cacheCreationInputTokens:a}:{}})).nullish(),specification:ep.object({specificationVersion:ep.literal("v2"),provider:ep.string(),modelId:ep.string()}),modelType:ep.enum(["language","embedding","image"]).nullish()}))}))),sV=nF(()=>sn(ep.object({balance:ep.string(),total_used:ep.string()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),sB=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...r}=e;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:a}=e,n=await nH(this.config.headers());try{let{responseHeaders:s,value:i,rawValue:o}=await nJ({url:this.getUrl(),headers:nw(n,e.headers,this.getModelConfigHeaders(this.modelId,!1),await nH(this.config.o11yHeaders)),body:t,successfulResponseHandler:nG(ep.any()),failedResponseHandler:nY({errorSchema:ep.any(),errorToMessage:e=>e}),...a&&{abortSignal:a},fetch:this.config.fetch});return{...i,request:{body:t},response:{headers:s,body:o},warnings:r}}catch(e){throw await s$(e,await sq(n))}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),{abortSignal:a}=e,n=await nH(this.config.headers());try{let s,{value:i,responseHeaders:o}=await nJ({url:this.getUrl(),headers:nw(n,e.headers,this.getModelConfigHeaders(this.modelId,!0),await nH(this.config.o11yHeaders)),body:t,successfulResponseHandler:(s=ep.any(),async({response:e})=>{let t=nT(e);if(null==e.body)throw new t7({});return{responseHeaders:t,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new rk).pipeThrough(new TransformStream({async transform({data:e},r){"[DONE]"!==e&&r.enqueue(await nz({text:e,schema:t}))}}))}({stream:e.body,schema:s})}}),failedResponseHandler:nY({errorSchema:ep.any(),errorToMessage:e=>e}),...a&&{abortSignal:a},fetch:this.config.fetch});return{stream:i.pipeThrough(new TransformStream({start(e){r.length>0&&e.enqueue({type:"stream-start",warnings:r})},transform(t,r){if(t.success){let a=t.value;("raw"!==a.type||e.includeRawChunks)&&("response-metadata"===a.type&&a.timestamp&&"string"==typeof a.timestamp&&(a.timestamp=new Date(a.timestamp)),r.enqueue(a))}else r.error(t.error)}})),request:{body:t},response:{headers:o}}}catch(e){throw await s$(e,await sq(n))}}isFilePart(e){return e&&"object"==typeof e&&"type"in e&&"file"===e.type}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)&&e.data instanceof Uint8Array){let t=Uint8Array.from(e.data),r=Buffer.from(t).toString("base64");e.data=new URL(`data:${e.mediaType||"application/octet-stream"};base64,${r}`)}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},sz=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:a}){var n;let s=await nH(this.config.headers());try{let{responseHeaders:i,value:o,rawValue:l}=await nJ({url:this.getUrl(),headers:nw(s,null!=t?t:{},this.getModelConfigHeaders(),await nH(this.config.o11yHeaders)),body:{input:1===e.length?e[0]:e,...a?{providerOptions:a}:{}},successfulResponseHandler:nG(sK),failedResponseHandler:nY({errorSchema:ep.any(),errorToMessage:e=>e}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:o.embeddings,usage:null!=(n=o.usage)?n:void 0,providerMetadata:o.providerMetadata,response:{headers:i,body:l}}}catch(e){throw await s$(e,await sq(s))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},sK=nF(()=>sn(ep.object({embeddings:ep.array(ep.array(ep.number())),usage:ep.object({tokens:ep.number()}).nullish(),providerMetadata:ep.record(ep.string(),ep.record(ep.string(),ep.unknown())).optional()})));async function sJ(){var e;return null==(e=(0,sm.getContext)().headers)?void 0:e["x-vercel-id"]}var sW=function(e={}){var t,r,a;let n=null,s=null,i=null!=(t=e.metadataCacheRefreshMillis)?t:3e5,o=0,l=null!=(r=null==(a=e.baseURL)?void 0:a.replace(/\/$/,""))?r:"https://ai-gateway.vercel.sh/v1/ai",u=async()=>{let t=await sH(e);if(t)return nR({Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":"0.0.1",[sD]:t.authMethod,...e.headers},"ai-sdk/gateway/2.0.7");throw sv.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},d=()=>{let e=nZ({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),t=nZ({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),r=nZ({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let a=await sJ();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...r&&{"ai-o11y-region":r},...a&&{"ai-o11y-request-id":a}}}},c=t=>new sB(t,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:d()}),p=async()=>new sF({baseURL:l,headers:u,fetch:e.fetch}).getCredits().catch(async e=>{throw await s$(e,await sq(await u()))}),m=function(e){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return c(e)};return m.getAvailableModels=async()=>{var t,r,a;let d=null!=(a=null==(r=null==(t=e._internal)?void 0:t.currentDate)?void 0:r.call(t).getTime())?a:Date.now();return(!n||d-o>i)&&(o=d,n=new sF({baseURL:l,headers:u,fetch:e.fetch}).getAvailableModels().then(e=>(s=e,e)).catch(async e=>{throw await s$(e,await sq(await u()))})),s?Promise.resolve(s):n},m.getCredits=p,m.imageModel=e=>{throw new rg({modelId:e,modelType:"imageModel"})},m.languageModel=c,m.textEmbeddingModel=t=>new sz(t,{provider:"gateway",baseURL:l,headers:u,fetch:e.fetch,o11yHeaders:d()}),m}();async function sH(e){let t=nZ({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await (0,sm.getVercelOidcToken)(),authMethod:"oidc"}}catch(e){return null}}var ep=ed,sY=e.i(84886),sG=e.i(19798),sX=Object.defineProperty,sQ="AI_NoOutputSpecifiedError",s0=`vercel.ai.error.${sQ}`,s1=Symbol.for(s0),s9=class extends t1{constructor({message:e="No output specified."}={}){super({name:sQ,message:e}),this[D]=!0}static isInstance(e){return t1.hasMarker(e,s0)}};D=s1;var s4=!1,s2="AI_InvalidArgumentError",s6=`vercel.ai.error.${s2}`,s5=Symbol.for(s6),s8=class extends t1{constructor({parameter:e,value:t,message:r}){super({name:s2,message:`Invalid argument for parameter ${e}: ${r}`}),this[q]=!0,this.parameter=e,this.value=t}static isInstance(e){return t1.hasMarker(e,s6)}};q=s5,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");var s3="AI_InvalidToolInputError",s7=`vercel.ai.error.${s3}`,ie=Symbol.for(s7),it=class extends t1{constructor({toolInput:e,toolName:t,cause:r,message:a=`Invalid input for tool ${t}: ${re(r)}`}){super({name:s3,message:a,cause:r}),this[U]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return t1.hasMarker(e,s7)}};U=ie,Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var ir="AI_NoObjectGeneratedError",ia=`vercel.ai.error.${ir}`,is=Symbol.for(ia),ii=class extends t1{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n,finishReason:s}){super({name:ir,message:e,cause:t}),this[F]=!0,this.text=r,this.response=a,this.usage=n,this.finishReason=s}static isInstance(e){return t1.hasMarker(e,ia)}};F=is;var io="AI_NoOutputGeneratedError",il=`vercel.ai.error.${io}`,iu=Symbol.for(il),id=class extends t1{constructor({message:e="No output generated.",cause:t}={}){super({name:io,message:e,cause:t}),this[L]=!0}static isInstance(e){return t1.hasMarker(e,il)}};L=iu;var ic="AI_NoSuchToolError",ip=`vercel.ai.error.${ic}`,im=Symbol.for(ip),ih=class extends t1{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ic,message:r}),this[V]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return t1.hasMarker(e,ip)}};V=im;var ig="AI_ToolCallRepairError",iy=`vercel.ai.error.${ig}`,iv=Symbol.for(iy),ib=class extends t1{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${re(e)}`}){super({name:ig,message:r,cause:e}),this[B]=!0,this.originalError=t}static isInstance(e){return t1.hasMarker(e,iy)}};B=iv;var i_=class extends t1{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},iw=(Symbol.for("vercel.ai.error.AI_InvalidDataContentError"),"AI_InvalidMessageRoleError"),ix=`vercel.ai.error.${iw}`,ik=Symbol.for(ix),iT=class extends t1{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:iw,message:t}),this[z]=!0,this.role=e}static isInstance(e){return t1.hasMarker(e,ix)}};z=ik,Symbol.for("vercel.ai.error.AI_MessageConversionError");var iI="AI_DownloadError",iE=`vercel.ai.error.${iI}`,iS=Symbol.for(iE),iO=class extends t1{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:iI,message:n,cause:a}),this[K]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return t1.hasMarker(e,iE)}};K=iS;var iA="AI_RetryError",iC=`vercel.ai.error.${iA}`,iN=Symbol.for(iC),iR=class extends t1{constructor({message:e,reason:t,errors:r}){super({name:iA,message:e}),this[J]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return t1.hasMarker(e,iC)}};function ij(e){var t;if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new i_({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return(null!=(t=globalThis.AI_SDK_DEFAULT_PROVIDER)?t:sW).languageModel(e)}J=iN;var iM=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],iP=async({url:e})=>{var t;let r=e.toString();try{let e=await fetch(r,{headers:nR({},"ai-sdk/5.0.89",nN())});if(!e.ok)throw new iO({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(iO.isInstance(e))throw e;throw new iO({url:r,cause:e})}},iZ=ep.union([ep.string(),ep.instanceof(Uint8Array),ep.instanceof(ArrayBuffer),ep.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function i$(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:r}=function(e){try{let[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==r)throw new t1({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}async function iD({prompt:e,supportedUrls:t,download:r=((e=iP)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))))()}){let a=await iq(e.messages,r,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var r;let a;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let n=e.type;switch(n){case"image":a=e.image;break;case"file":a=e.data;break;default:throw Error(`Unsupported part type: ${n}`)}let{data:s,mediaType:i}=i$(a),o=null!=i?i:e.mediaType,l=s;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=o||(o=e.mediaType))}switch(n){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(o=null!=(r=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?(e=>{let t="string"==typeof e?sd(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)})(e):e,a="string"==typeof r?sd(r.substring(0,Math.min(r.length,24))):r;for(let e of t)if(a.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>null===e||a[t]===e))return e.mediaType}({data:l,signatures:iM}))?r:o),{type:"file",mediaType:null!=o?o:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==o)throw Error("Media type is missing for file part");return{type:"file",mediaType:o,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text||null!=e.providerOptions).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:r,mediaType:a}=i$(e.data);return{type:"file",data:r,filename:e.filename,mediaType:null!=a?a:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new iT({role:r})}})({message:e,downloadedAssets:a}))]}async function iq(e,t,r){let a=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let r=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,a="image"===e.type?e.image:e.data;if("string"==typeof a)try{a=new URL(a)}catch(e){}return{mediaType:r,data:a}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&function({mediaType:e,url:t,supportedUrls:r}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(r).map(([e,t])=>{let r=e.toLowerCase();return"*"===r||"*/*"===r?{mediaTypePrefix:"",regexes:t}:{mediaTypePrefix:r.replace(/\*/,""),regexes:t}}).filter(({mediaTypePrefix:t})=>e.startsWith(t)).flatMap(({regexes:e})=>e).some(e=>e.test(t))}({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:r})}));return Object.fromEntries((await t(a)).map((e,t)=>null==e?null:[a[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}var iU=ep.lazy(()=>ep.union([ep.null(),ep.string(),ep.number(),ep.boolean(),ep.record(ep.string(),iU),ep.array(iU)])),iF=ep.record(ep.string(),ep.record(ep.string(),iU)),iL=ep.object({type:ep.literal("text"),text:ep.string(),providerOptions:iF.optional()}),iV=ep.object({type:ep.literal("image"),image:ep.union([iZ,ep.instanceof(URL)]),mediaType:ep.string().optional(),providerOptions:iF.optional()}),iB=ep.object({type:ep.literal("file"),data:ep.union([iZ,ep.instanceof(URL)]),filename:ep.string().optional(),mediaType:ep.string(),providerOptions:iF.optional()}),iz=ep.object({type:ep.literal("reasoning"),text:ep.string(),providerOptions:iF.optional()}),iK=ep.object({type:ep.literal("tool-call"),toolCallId:ep.string(),toolName:ep.string(),input:ep.unknown(),providerOptions:iF.optional(),providerExecuted:ep.boolean().optional()}),iJ=ep.discriminatedUnion("type",[ep.object({type:ep.literal("text"),value:ep.string()}),ep.object({type:ep.literal("json"),value:iU}),ep.object({type:ep.literal("error-text"),value:ep.string()}),ep.object({type:ep.literal("error-json"),value:iU}),ep.object({type:ep.literal("content"),value:ep.array(ep.union([ep.object({type:ep.literal("text"),text:ep.string()}),ep.object({type:ep.literal("media"),data:ep.string(),mediaType:ep.string()})]))})]),iW=ep.object({type:ep.literal("tool-result"),toolCallId:ep.string(),toolName:ep.string(),output:iJ,providerOptions:iF.optional()}),iH=ep.object({role:ep.literal("system"),content:ep.string(),providerOptions:iF.optional()}),iY=ep.object({role:ep.literal("user"),content:ep.union([ep.string(),ep.array(ep.union([iL,iV,iB]))]),providerOptions:iF.optional()}),iG=ep.object({role:ep.literal("assistant"),content:ep.union([ep.string(),ep.array(ep.union([iL,iB,iz,iK,iW]))]),providerOptions:iF.optional()}),iX=ep.object({role:ep.literal("tool"),content:ep.array(iW),providerOptions:iF.optional()}),iQ=ep.union([iH,iY,iG,iX]);async function i0(e){let t;if(null==e.prompt&&null==e.messages)throw new rl({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new rl({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new rl({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new rl({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new rl({prompt:e,message:"messages must not be empty"});let r=await nV({value:t,schema:ep.array(iQ)});if(!r.success)throw new rl({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function i1({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var i9={startSpan:()=>i4,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(i4):"function"==typeof r?r(i4):"function"==typeof a?a(i4):void 0},i4={spanContext:()=>i2,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},i2={traceId:"",spanId:"",traceFlags:0};function i6({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{i5(e,t)}finally{e.end()}throw t}})}function i5(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:sG.SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:sG.SpanStatusCode.ERROR})}function i8({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(null==a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return null==n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return null==n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}function i3(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function i7(e){return void 0===e?[]:Array.isArray(e)?e:[e]}async function oe(e,{maxRetries:t,delayInMs:r,backoffFactor:a,abortSignal:n},s=[]){try{return await e()}catch(u){if(nO(u)||0===t)throw u;let i=nS(u),o=[...s,u],l=o.length;if(l>t)throw new iR({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:o});if(u instanceof Error&&t6.isInstance(u)&&!0===u.isRetryable&&l<=t)return await nx(function({error:e,exponentialBackoffDelay:t}){let r,a=e.responseHeaders;if(!a)return t;let n=a["retry-after-ms"];if(n){let e=parseFloat(n);Number.isNaN(e)||(r=e)}let s=a["retry-after"];if(s&&void 0===r){let e=parseFloat(s);r=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}return null!=r&&!Number.isNaN(r)&&0<=r&&(r<6e4||r<t)?r:t}({error:u,exponentialBackoffDelay:r}),{abortSignal:n}),oe(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a,abortSignal:n},o);if(1===l)throw u;throw new iR({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:o})}}var ot=class{constructor({data:e,mediaType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=sc(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=sd(this.base64Data)),this.uint8ArrayData}},or=class extends ot{constructor(e){super(e),this.type="file"}};async function oa({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){try{if(null==t)throw new ih({toolName:e.toolName});try{return await on({toolCall:e,tools:t})}catch(i){if(null==r||!(ih.isInstance(i)||it.isInstance(i)))throw i;let s=null;try{s=await r({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:r}=t[e];return so(r).jsonSchema},system:a,messages:n,error:i})}catch(e){throw new ib({cause:e,originalError:i})}if(null==s)throw i;return await on({toolCall:s,tools:t})}}catch(a){let t=await nz({text:e.input}),r=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:a}}}async function on({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new ih({toolName:e.toolName,availableTools:Object.keys(t)});let n=so(a.inputSchema),s=""===e.input.trim()?await nV({value:{},schema:n}):await nz({text:e.input,schema:n});if(!1===s.success)throw new it({toolName:r,toolInput:e.input,cause:s.error});return"dynamic"===a.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var os=class{constructor({content:e,finishReason:t,usage:r,warnings:a,request:n,response:s,providerMetadata:i}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=a,this.request=n,this.response=s,this.providerMetadata=i}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!0!==e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!0!==e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};async function oi({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function oo({output:e,tool:t,errorMode:r}){return"text"===r?{type:"error-text",value:re(e)}:"json"===r?{type:"error-json",value:ol(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:ol(e)}}function ol(e){return void 0===e?null:e}function ou({content:e,tools:t}){let r=[],a=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:oo({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:oo({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});a.length>0&&r.push({role:"assistant",content:a});let n=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:oo({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return n.length>0&&r.push({role:"tool",content:n}),r}function od(e,t){let r=new Headers(null!=e?e:{});for(let[e,a]of Object.entries(t))r.has(e)||r.set(e,a);return r}function oc({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);let s=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await s.read();if(t)break;e.write(r)||await new Promise(t=>{e.once("drain",t)})}}catch(e){throw e}finally{e.end()}})()}nI({prefix:"aitxt",size:24});var op=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},om={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};async function oh(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await nz({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await nz({text:function(e){let t=["ROOT"],r=-1,a=null;function n(e,n,s){switch(e){case'"':r=n,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,a=n,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function i(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let o=0;o<e.length;o++){let l=e[o];switch(t[t.length-1]){case"ROOT":n(l,o,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=o,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(l,o,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,o);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=o;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=o}break;case"INSIDE_ARRAY_START":"]"===l?(r=o,t.pop()):(r=o,n(l,o,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop();break;default:r=o}break;case"INSIDE_ARRAY_AFTER_COMMA":n(l,o,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=o;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,o);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,o);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(a,o+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=o:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,o):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o))}}}let o=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?o+="true".slice(t.length):"false".startsWith(t)?o+="false".slice(t.length):"null".startsWith(t)&&(o+="null".slice(t.length))}}return o}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function of(e){return e.type.startsWith("tool-")}function og(e){return e.type.split("-").slice(1).join("-")}function oy(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function r(r){var a;t=!0;try{r&&await (null==(a=e.cancel)?void 0:a.call(e))}finally{try{e.releaseLock()}catch(e){}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:a,value:n}=await e.read();return a?(await r(!0),{done:!0,value:void 0}):{done:!1,value:n}},return:async()=>(await r(!0),{done:!0,value:void 0}),async throw(e){throw await r(!0),e}}},t}async function ov({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function ob(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}nF(()=>sn(ep.union([ep.strictObject({type:ep.literal("text-start"),id:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("text-delta"),id:ep.string(),delta:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("text-end"),id:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("error"),errorText:ep.string()}),ep.strictObject({type:ep.literal("tool-input-start"),toolCallId:ep.string(),toolName:ep.string(),providerExecuted:ep.boolean().optional(),dynamic:ep.boolean().optional()}),ep.strictObject({type:ep.literal("tool-input-delta"),toolCallId:ep.string(),inputTextDelta:ep.string()}),ep.strictObject({type:ep.literal("tool-input-available"),toolCallId:ep.string(),toolName:ep.string(),input:ep.unknown(),providerExecuted:ep.boolean().optional(),providerMetadata:iF.optional(),dynamic:ep.boolean().optional()}),ep.strictObject({type:ep.literal("tool-input-error"),toolCallId:ep.string(),toolName:ep.string(),input:ep.unknown(),providerExecuted:ep.boolean().optional(),providerMetadata:iF.optional(),dynamic:ep.boolean().optional(),errorText:ep.string()}),ep.strictObject({type:ep.literal("tool-output-available"),toolCallId:ep.string(),output:ep.unknown(),providerExecuted:ep.boolean().optional(),dynamic:ep.boolean().optional(),preliminary:ep.boolean().optional()}),ep.strictObject({type:ep.literal("tool-output-error"),toolCallId:ep.string(),errorText:ep.string(),providerExecuted:ep.boolean().optional(),dynamic:ep.boolean().optional()}),ep.strictObject({type:ep.literal("reasoning-start"),id:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("reasoning-delta"),id:ep.string(),delta:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("reasoning-end"),id:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("source-url"),sourceId:ep.string(),url:ep.string(),title:ep.string().optional(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("source-document"),sourceId:ep.string(),mediaType:ep.string(),title:ep.string(),filename:ep.string().optional(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.literal("file"),url:ep.string(),mediaType:ep.string(),providerMetadata:iF.optional()}),ep.strictObject({type:ep.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:ep.string().optional(),data:ep.unknown(),transient:ep.boolean().optional()}),ep.strictObject({type:ep.literal("start-step")}),ep.strictObject({type:ep.literal("finish-step")}),ep.strictObject({type:ep.literal("start"),messageId:ep.string().optional(),messageMetadata:ep.unknown().optional()}),ep.strictObject({type:ep.literal("finish"),messageMetadata:ep.unknown().optional()}),ep.strictObject({type:ep.literal("abort")}),ep.strictObject({type:ep.literal("message-metadata"),messageMetadata:ep.unknown()})])));var o_=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}},ow=nI({prefix:"aitxt",size:24}),ox=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:n,abortSignal:s,system:i,prompt:o,messages:l,tools:u,toolChoice:d,transforms:c,activeTools:p,repairToolCall:m,stopConditions:h,output:f,providerOptions:g,prepareStep:y,includeRawChunks:v,now:b,currentDate:_,generateId:w,onChunk:x,onError:k,onFinish:T,onAbort:I,onStepFinish:E,experimental_context:S,download:O}){let A,C,N,R;this._totalUsage=new o_,this._finishReason=new o_,this._steps=new o_,this.output=f,this.includeRawChunks=v,this.tools=u;let j=[],M=[],P={},Z=[],$=[],D={},q={},U=new TransformStream({async transform(e,t){var r,a,n,s,i;t.enqueue(e);let{part:o}=e;if(("text-delta"===o.type||"reasoning-delta"===o.type||"source"===o.type||"tool-call"===o.type||"tool-result"===o.type||"tool-input-start"===o.type||"tool-input-delta"===o.type||"raw"===o.type)&&await (null==x?void 0:x({chunk:o})),"error"===o.type&&await k({error:(i=o.error,sv.isInstance(i)||sO.isInstance(i)?new t1({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:i}):i)}),"text-start"===o.type&&(D[o.id]={type:"text",text:"",providerMetadata:o.providerMetadata},j.push(D[o.id])),"text-delta"===o.type){let e=D[o.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${o.id} not found`},partialOutput:void 0});e.text+=o.text,e.providerMetadata=null!=(r=o.providerMetadata)?r:e.providerMetadata}if("text-end"===o.type){let e=D[o.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${o.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(a=o.providerMetadata)?a:e.providerMetadata,delete D[o.id]}if("reasoning-start"===o.type&&(q[o.id]={type:"reasoning",text:"",providerMetadata:o.providerMetadata},j.push(q[o.id])),"reasoning-delta"===o.type){let e=q[o.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${o.id} not found`},partialOutput:void 0});e.text+=o.text,e.providerMetadata=null!=(n=o.providerMetadata)?n:e.providerMetadata}if("reasoning-end"===o.type){let e=q[o.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${o.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(s=o.providerMetadata)?s:e.providerMetadata,delete q[o.id]}if("file"===o.type&&j.push({type:"file",file:o.file}),"source"===o.type&&j.push(o),"tool-call"===o.type&&j.push(o),"tool-result"!==o.type||o.preliminary||j.push(o),"tool-error"===o.type&&j.push(o),"start-step"===o.type&&(P=o.request,Z=o.warnings),"finish-step"===o.type){let e=ou({content:j,tools:u}),t=new os({content:j,finishReason:o.finishReason,usage:o.usage,warnings:Z,request:P,response:{...o.response,messages:[...M,...e]},providerMetadata:o.providerMetadata});await (null==E?void 0:E(t)),(e=>{if(0===e.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t)return t(e);for(let t of(s4||(s4=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e))console.warn(function(e){let t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let r=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"unsupported-tool":{let r="name"in e.tool?e.tool.name:"unknown tool",a=`${t} The tool "${r}" is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}(t))}})(Z),$.push(t),j=[],q={},D={},M.push(...e),A.resolve()}"finish"===o.type&&(R=o.totalUsage,N=o.finishReason)},async flush(e){try{if(0===$.length){let e=new id({message:"No output generated. Check the stream for errors."});H._finishReason.reject(e),H._totalUsage.reject(e),H._steps.reject(e);return}let e=null!=N?N:"unknown",r=null!=R?R:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};H._finishReason.resolve(e),H._totalUsage.resolve(r),H._steps.resolve($);let a=$[$.length-1];await (null==T?void 0:T({finishReason:e,totalUsage:r,usage:a.usage,content:a.content,text:a.text,reasoningText:a.reasoningText,reasoning:a.reasoning,files:a.files,sources:a.sources,toolCalls:a.toolCalls,staticToolCalls:a.staticToolCalls,dynamicToolCalls:a.dynamicToolCalls,toolResults:a.toolResults,staticToolResults:a.staticToolResults,dynamicToolResults:a.dynamicToolResults,request:a.request,response:a.response,warnings:a.warnings,providerMetadata:a.providerMetadata,steps:$})),C.setAttributes(i8({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>a.text},"ai.response.toolCalls":{output:()=>{var e;return(null==(e=a.toolCalls)?void 0:e.length)?JSON.stringify(a.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(a.providerMetadata),"ai.usage.inputTokens":r.inputTokens,"ai.usage.outputTokens":r.outputTokens,"ai.usage.totalTokens":r.totalTokens,"ai.usage.reasoningTokens":r.reasoningTokens,"ai.usage.cachedInputTokens":r.cachedInputTokens}}))}catch(t){e.error(t)}finally{C.end()}}}),F=function(){let e=[],t=null,r=!1,a=ob(),n=()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},s=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=ob(),await a.promise,s();try{let{value:a,done:n}=await e[0].read();n?(e.shift(),e.length>0?await s():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(r){null==t||t.error(r),e.shift(),n()}};return{stream:new ReadableStream({start(e){t=e},pull:s,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:n}}();this.addStream=F.addStream,this.closeStream=F.close;let L=F.stream.getReader(),V=new ReadableStream({async start(e){e.enqueue({type:"start"})},async pull(e){function t(){null==I||I({steps:$}),e.enqueue({type:"abort"}),e.close()}try{let{done:r,value:a}=await L.read();if(r)return void e.close();if(null==s?void 0:s.aborted)return void t();e.enqueue(a)}catch(r){nO(r)&&(null==s?void 0:s.aborted)?t():e.error(r)}},cancel:e=>F.stream.cancel(e)});for(let e of c)V=V.pipeThrough(e({tools:u,stopStream(){F.terminate()}}));this.baseStream=V.pipeThrough(function(e){let t;if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let r="",a="",n="";function s({controller:e,partialOutput:r}){e.enqueue({part:{type:"text-delta",id:t,text:a},partialOutput:r}),a=""}return new TransformStream({async transform(i,o){if("finish-step"===i.type&&a.length>0&&s({controller:o}),"text-delta"!==i.type&&"text-start"!==i.type&&"text-end"!==i.type)return void o.enqueue({part:i,partialOutput:void 0});if(null==t)t=i.id;else if(i.id!==t)return void o.enqueue({part:i,partialOutput:void 0});if("text-start"===i.type)return void o.enqueue({part:i,partialOutput:void 0});if("text-end"===i.type){a.length>0&&s({controller:o}),o.enqueue({part:i,partialOutput:void 0});return}r+=i.text,a+=i.text;let l=await e.parsePartial({text:r});if(null!=l){let e=JSON.stringify(l.partial);e!==n&&(s({controller:o,partialOutput:l.partial}),n=e)}}})}(f)).pipeThrough(U);let{maxRetries:B,retry:z}=function({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new s8({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new s8({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let r=null!=e?e:2;return{maxRetries:r,retry:(({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:a}={})=>async n=>oe(n,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:a}))({maxRetries:r,abortSignal:t})}}({maxRetries:n,abortSignal:s}),K=function({isEnabled:e=!1,tracer:t}={}){return e?t||sY.trace.getTracer("ai"):i9}(t),J=function({maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,seed:i,stopSequences:o}){if(null!=e){if(!Number.isInteger(e))throw new s8({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new s8({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new s8({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new s8({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new s8({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new s8({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new s8({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new s8({parameter:"seed",value:i,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:o,seed:i}}(a),W=function({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}({model:e,telemetry:t,headers:r,settings:{...J,maxRetries:B}}),H=this;i6({name:"ai.streamText",attributes:i8({telemetry:t,attributes:{...i1({operationId:"ai.streamText",telemetry:t}),...W,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:o,messages:l})}}}),tracer:K,endWhenDone:!1,fn:async a=>{async function n({currentStep:a,responseMessages:c,usage:v}){var x,k,T,I,E;let C,N,R=H.includeRawChunks;A=new o_;let j=await i0({system:i,prompt:o,messages:l}),M=[...j.messages,...c],P=await (null==y?void 0:y({model:e,steps:$,stepNumber:$.length,messages:M})),Z=ij(null!=(x=null==P?void 0:P.model)?x:e),D=await iD({prompt:{system:null!=(k=null==P?void 0:P.system)?k:j.system,messages:null!=(T=null==P?void 0:P.messages)?T:M},supportedUrls:await Z.supportedUrls,download:O}),{toolChoice:q,tools:U}=function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:so(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:u,toolChoice:null!=(I=null==P?void 0:P.toolChoice)?I:d,activeTools:null!=(E=null==P?void 0:P.activeTools)?E:p}),{result:{stream:F,response:L,request:V},doStreamSpan:B,startTimestampMs:Y}=await z(()=>i6({name:"ai.streamText.doStream",attributes:i8({telemetry:t,attributes:{...i1({operationId:"ai.streamText.doStream",telemetry:t}),...W,"ai.model.provider":Z.provider,"ai.model.id":Z.modelId,"ai.prompt.messages":{input:()=>JSON.stringify(D.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?sc(new Uint8Array(t)):sc(t):e.data}:e})})))},"ai.prompt.tools":{input:()=>null==U?void 0:U.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=q?JSON.stringify(q):void 0},"gen_ai.system":Z.provider,"gen_ai.request.model":Z.modelId,"gen_ai.request.frequency_penalty":J.frequencyPenalty,"gen_ai.request.max_tokens":J.maxOutputTokens,"gen_ai.request.presence_penalty":J.presencePenalty,"gen_ai.request.stop_sequences":J.stopSequences,"gen_ai.request.temperature":J.temperature,"gen_ai.request.top_k":J.topK,"gen_ai.request.top_p":J.topP}}),tracer:K,endWhenDone:!1,fn:async e=>({startTimestampMs:b(),doStreamSpan:e,result:await Z.doStream({...J,tools:U,toolChoice:q,responseFormat:null==f?void 0:f.responseFormat,prompt:D,providerOptions:g,abortSignal:s,headers:r,includeRawChunks:R})})})),G=function({tools:e,generatorStream:t,tracer:r,telemetry:a,system:n,messages:s,abortSignal:i,repairToolCall:o,experimental_context:l}){let u,d=null,c=new ReadableStream({start(e){d=e}}),p=new Set,m=new Map,h=!1;function f(){h&&0===p.size&&(null!=u&&d.enqueue(u),d.close())}let g=new TransformStream({async transform(t,c){let h=t.type;switch(h){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":c.enqueue(t);break;case"file":c.enqueue({type:"file",file:new or({data:t.data,mediaType:t.mediaType})});break;case"finish":u={type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case"tool-call":try{let u=await oa({toolCall:t,tools:e,repairToolCall:o,system:n,messages:s});if(c.enqueue(u),u.invalid){d.enqueue({type:"tool-error",toolCallId:u.toolCallId,toolName:u.toolName,input:u.input,error:nS(u.error),dynamic:!0});break}let h=e[u.toolName];if(m.set(u.toolCallId,u.input),null!=h.onInputAvailable&&await h.onInputAvailable({input:u.input,toolCallId:u.toolCallId,messages:s,abortSignal:i,experimental_context:l}),null!=h.execute&&!0!==u.providerExecuted){let e=nE();p.add(e),i6({name:"ai.toolCall",attributes:i8({telemetry:a,attributes:{...i1({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":u.toolName,"ai.toolCall.id":u.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(u.input)}}}),tracer:r,fn:async t=>{let r;try{for await(let e of sp({execute:h.execute.bind(h),input:u.input,options:{toolCallId:u.toolCallId,messages:s,abortSignal:i,experimental_context:l}}))d.enqueue({...u,type:"tool-result",output:e.output,..."preliminary"===e.type&&{preliminary:!0}}),"final"===e.type&&(r=e.output)}catch(r){i5(t,r),d.enqueue({...u,type:"tool-error",error:r}),p.delete(e),f();return}p.delete(e),f();try{t.setAttributes(i8({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}}})}}catch(e){d.enqueue({type:"error",error:e})}break;case"tool-result":{let e=t.toolName;t.isError?d.enqueue({type:"tool-error",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):c.enqueue({type:"tool-result",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),c.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:F,tracer:K,telemetry:t,system:i,messages:M,repairToolCall:m,abortSignal:s,experimental_context:S}),X=null!=V?V:{},Q=[],ee=[],et={},er="unknown",ea={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},en=!0,es={id:w(),timestamp:_(),modelId:e.modelId},ei="";H.addStream(G.pipeThrough(new TransformStream({async transform(e,t){var r,a,n,i;if("stream-start"===e.type){C=e.warnings;return}if(en){let e=b()-Y;en=!1,B.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),B.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"start-step",request:X,warnings:null!=C?C:[]})}let o=e.type;switch(o){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":t.enqueue(e);break;case"text-delta":e.delta.length>0&&(t.enqueue({type:"text-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),ei+=e.delta);break;case"reasoning-delta":t.enqueue({type:"reasoning-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case"tool-call":t.enqueue(e),Q.push(e);break;case"tool-result":t.enqueue(e),e.preliminary||ee.push(e);break;case"tool-error":t.enqueue(e),ee.push(e);break;case"response-metadata":es={id:null!=(r=e.id)?r:es.id,timestamp:null!=(a=e.timestamp)?a:es.timestamp,modelId:null!=(n=e.modelId)?n:es.modelId};break;case"finish":{ea=e.usage,er=e.finishReason,N=e.providerMetadata;let t=b()-Y;B.addEvent("ai.stream.finish"),B.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(i=ea.outputTokens)?i:0)/t});break}case"tool-input-start":{et[e.id]=e.toolName;let r=null==u?void 0:u[e.toolName];(null==r?void 0:r.onInputStart)!=null&&await r.onInputStart({toolCallId:e.id,messages:M,abortSignal:s,experimental_context:S}),t.enqueue({...e,dynamic:(null==r?void 0:r.type)==="dynamic"});break}case"tool-input-end":delete et[e.id],t.enqueue(e);break;case"tool-input-delta":{let r=et[e.id],a=null==u?void 0:u[r];(null==a?void 0:a.onInputDelta)!=null&&await a.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:M,abortSignal:s,experimental_context:S}),t.enqueue(e);break}case"error":t.enqueue(e),er="error";break;case"raw":R&&t.enqueue(e);break;default:throw Error(`Unknown chunk type: ${o}`)}},async flush(e){var r;let s=Q.length>0?JSON.stringify(Q):void 0;try{B.setAttributes(i8({telemetry:t,attributes:{"ai.response.finishReason":er,"ai.response.text":{output:()=>ei},"ai.response.toolCalls":{output:()=>s},"ai.response.id":es.id,"ai.response.model":es.modelId,"ai.response.timestamp":es.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(N),"ai.usage.inputTokens":ea.inputTokens,"ai.usage.outputTokens":ea.outputTokens,"ai.usage.totalTokens":ea.totalTokens,"ai.usage.reasoningTokens":ea.reasoningTokens,"ai.usage.cachedInputTokens":ea.cachedInputTokens,"gen_ai.response.finish_reasons":[er],"gen_ai.response.id":es.id,"gen_ai.response.model":es.modelId,"gen_ai.usage.input_tokens":ea.inputTokens,"gen_ai.usage.output_tokens":ea.outputTokens}}))}catch(e){}finally{B.end()}e.enqueue({type:"finish-step",finishReason:er,usage:ea,providerMetadata:N,response:{...es,headers:null==L?void 0:L.headers}});let i=(r=ea,{inputTokens:i3(v.inputTokens,r.inputTokens),outputTokens:i3(v.outputTokens,r.outputTokens),totalTokens:i3(v.totalTokens,r.totalTokens),reasoningTokens:i3(v.reasoningTokens,r.reasoningTokens),cachedInputTokens:i3(v.cachedInputTokens,r.cachedInputTokens)});await A.promise;let o=Q.filter(e=>!0!==e.providerExecuted),l=ee.filter(e=>!0!==e.providerExecuted);if(o.length>0&&l.length===o.length&&!await oi({stopConditions:h,steps:$})){c.push(...ou({content:$[$.length-1].content,tools:u}));try{await n({currentStep:a+1,responseMessages:c,usage:i})}catch(t){e.enqueue({type:"error",error:t}),H.closeStream()}}else e.enqueue({type:"finish",finishReason:er,totalUsage:i}),H.closeStream()}})))}C=a,await n({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{H.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),H.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return oy(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.text)}})))}get fullStream(){return oy(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await ov({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(r){null==(t=null==e?void 0:e.onError)||t.call(e,r)}}get experimental_partialOutputStream(){if(null==this.output)throw new s9;return oy(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:n=!0,sendSources:s=!1,sendStart:i=!0,sendFinish:o=!0,onError:l=re}={}){let u=null!=t?function({originalMessages:e,responseMessageId:t}){if(null==e)return;let r=e[e.length-1];return(null==r?void 0:r.role)==="assistant"?r.id:"function"==typeof t?t():t}({originalMessages:e,responseMessageId:t}):void 0,d={},c=e=>{var t,r;let a=d[e];return(null==(r=null==(t=this.tools)?void 0:t[a])?void 0:r.type)==="dynamic"||void 0};return oy(function({messageId:e,originalMessages:t=[],onFinish:r,onError:a,stream:n}){let s=null==t?void 0:t[t.length-1];(null==s?void 0:s.role)!=="assistant"?s=void 0:e=s.id;let i=!1,o=n.pipeThrough(new TransformStream({transform(t,r){"start"===t.type&&null==t.messageId&&null!=e&&(t.messageId=e),"abort"===t.type&&(i=!0),r.enqueue(t)}}));if(null==r)return o;let l=function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:s?structuredClone(s):void 0,messageId:null!=e?e:""}),u=!1,d=async()=>{if(u||!r)return;u=!0;let e=l.message.id===(null==s?void 0:s.id);await r({isAborted:i,isContinuation:e,responseMessage:l.message,messages:[...e?t.slice(0,-1):t,l.message]})};return(function({stream:e,messageMetadataSchema:t,dataPartSchemas:r,runUpdateMessageJob:a,onError:n,onToolCall:s,onData:i}){return e.pipeThrough(new TransformStream({async transform(e,o){await a(async({state:a,write:l})=>{var u,d,c,p;function m(e){let t=a.message.parts.filter(of).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function h(e){let t=a.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function f(e){var t;let r=a.message.parts.find(t=>of(t)&&t.toolCallId===e.toolCallId);null!=r?(r.state=e.state,r.input=e.input,r.output=e.output,r.errorText=e.errorText,r.rawInput=e.rawInput,r.preliminary=e.preliminary,r.providerExecuted=null!=(t=e.providerExecuted)?t:r.providerExecuted,null!=e.providerMetadata&&"input-available"===r.state&&(r.callProviderMetadata=e.providerMetadata)):a.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function g(e){var t,r;let n=a.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=n?(n.state=e.state,n.toolName=e.toolName,n.input=e.input,n.output=e.output,n.errorText=e.errorText,n.rawInput=null!=(t=e.rawInput)?t:n.rawInput,n.preliminary=e.preliminary,n.providerExecuted=null!=(r=e.providerExecuted)?r:n.providerExecuted,null!=e.providerMetadata&&"input-available"===n.state&&(n.callProviderMetadata=e.providerMetadata)):a.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function y(e){if(null!=e){let r=null!=a.message.metadata?function e(t,r){if(void 0===t&&void 0===r)return;if(void 0===t)return r;if(void 0===r)return t;let a={...t};for(let n in r)if(Object.prototype.hasOwnProperty.call(r,n)){let s=r[n];if(void 0===s)continue;let i=n in t?t[n]:void 0,o=null!==s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);o&&l?a[n]=e(i,s):a[n]=s}return a}(a.message.metadata,e):e;null!=t&&await nL({value:r,schema:t}),a.message.metadata=r}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};a.activeTextParts[e.id]=t,a.message.parts.push(t),l();break}case"text-delta":{let t=a.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,l();break}case"text-end":{let t=a.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,delete a.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};a.activeReasoningParts[e.id]=t,a.message.parts.push(t),l();break}case"reasoning-delta":{let t=a.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,l();break}case"reasoning-end":{let t=a.activeReasoningParts[e.id];t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,t.state="done",delete a.activeReasoningParts[e.id],l();break}case"file":a.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":a.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":a.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=a.message.parts.filter(of);a.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),l();break}case"tool-input-delta":{let t=a.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:r}=await oh(t.text);t.dynamic?g({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:r}):f({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:r}),l();break}case"tool-input-available":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l(),s&&!e.providerExecuted&&await s({toolCall:e});break;case"tool-input-error":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l();break;case"tool-output-available":if(e.dynamic){let t=h(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:og(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}l();break;case"tool-output-error":if(e.dynamic){let t=h(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:og(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted})}l();break;case"start-step":a.message.parts.push({type:"step-start"});break;case"finish-step":a.activeTextParts={},a.activeReasoningParts={};break;case"start":null!=e.messageId&&(a.message.id=e.messageId),await y(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":case"message-metadata":await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==n||n(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==r?void 0:r[e.type])!=null&&await nL({value:e.data,schema:r[e.type]}),e.transient){null==i||i(e);break}let t=null!=e.id?a.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:a.message.parts.push(e),null==i||i(e),l()}}o.enqueue(e)})}}))})({stream:o,runUpdateMessageJob:async e=>{await e({state:l,write:()=>{}})},onError:a}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await d()},async flush(){await d()}}))}({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let r=null==a?void 0:a({part:e}),p=e.type;switch(p){case"text-start":t.enqueue({type:"text-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-delta":t.enqueue({type:"text-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-end":t.enqueue({type:"text-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-start":t.enqueue({type:"reasoning-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-delta":n&&t.enqueue({type:"reasoning-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-end":t.enqueue({type:"reasoning-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"file":t.enqueue({type:"file",mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case"source":s&&"url"===e.sourceType&&t.enqueue({type:"source-url",sourceId:e.id,url:e.url,title:e.title,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}),s&&"document"===e.sourceType&&t.enqueue({type:"source-document",sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"tool-input-start":{d[e.id]=e.toolName;let r=c(e.id);t.enqueue({type:"tool-input-start",toolCallId:e.id,toolName:e.toolName,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=r?{dynamic:r}:{}});break}case"tool-input-delta":t.enqueue({type:"tool-input-delta",toolCallId:e.id,inputTextDelta:e.delta});break;case"tool-call":{d[e.toolCallId]=e.toolName;let r=c(e.toolCallId);e.invalid?t.enqueue({type:"tool-input-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=r?{dynamic:r}:{},errorText:l(e.error)}):t.enqueue({type:"tool-input-available",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=r?{dynamic:r}:{}});break}case"tool-result":{let r=c(e.toolCallId);t.enqueue({type:"tool-output-available",toolCallId:e.toolCallId,output:e.output,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.preliminary?{preliminary:e.preliminary}:{},...null!=r?{dynamic:r}:{}});break}case"tool-error":{let r=c(e.toolCallId);t.enqueue({type:"tool-output-error",toolCallId:e.toolCallId,errorText:l(e.error),...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=r?{dynamic:r}:{}});break}case"error":t.enqueue({type:"error",errorText:l(e.error)});break;case"start-step":t.enqueue({type:"start-step"});break;case"finish-step":t.enqueue({type:"finish-step"});break;case"start":i&&t.enqueue({type:"start",...null!=r?{messageMetadata:r}:{},...null!=u?{messageId:u}:{}});break;case"finish":o&&t.enqueue({type:"finish",...null!=r?{messageMetadata:r}:{}});break;case"abort":t.enqueue(e);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${p}`)}null!=r&&"start"!==p&&"finish"!==p&&t.enqueue({type:"message-metadata",messageMetadata:r})}})),messageId:null!=u?u:null==t?void 0:t(),originalMessages:e,onFinish:r,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:r,onFinish:a,messageMetadata:n,sendReasoning:s,sendSources:i,sendFinish:o,sendStart:l,onError:u,...d}={}){!function({response:e,status:t,statusText:r,headers:a,stream:n,consumeSseStream:s}){let i=n.pipeThrough(new op);if(s){let[e,t]=i.tee();i=e,s({stream:t})}oc({response:e,status:t,statusText:r,headers:Object.fromEntries(od(a,om).entries()),stream:i.pipeThrough(new TextEncoderStream)})}({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:r,onFinish:a,messageMetadata:n,sendReasoning:s,sendSources:i,sendFinish:o,sendStart:l,onError:u}),...d})}pipeTextStreamToResponse(e,t){!function({response:e,status:t,statusText:r,headers:a,textStream:n}){oc({response:e,status:t,statusText:r,headers:Object.fromEntries(od(a,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:n.pipeThrough(new TextEncoderStream)})}({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:o,onError:l,...u}={}){return function({status:e,statusText:t,headers:r,stream:a,consumeSseStream:n}){let s=a.pipeThrough(new op);if(n){let[e,t]=s.tee();s=e,n({stream:t})}return new Response(s.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:od(r,om)})}({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:a,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:o,onError:l}),...u})}toTextStreamResponse(e){return function({status:e,statusText:t,headers:r,textStream:a}){return new Response(a.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:od(r,{"content-type":"text/plain; charset=utf-8"})})}({textStream:this.textStream,...e})}};nI({prefix:"aiobj",size:24}),nI({prefix:"aiobj",size:24}),((e,t)=>{for(var r in t)sX(e,r,{get:t[r],enumerable:!0})})({},{object:()=>oT,text:()=>ok});var ok=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),oT=({schema:e})=>{let t=so(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await oh(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},r){let a=await nz({text:e});if(!a.success)throw new ii({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await nV({value:a.value,schema:t});if(!n.success)throw new ii({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),nF(()=>sn(ep.array(ep.object({id:ep.string(),role:ep.enum(["system","user","assistant"]),metadata:ep.unknown().optional(),parts:ep.array(ep.union([ep.object({type:ep.literal("text"),text:ep.string(),state:ep.enum(["streaming","done"]).optional(),providerMetadata:iF.optional()}),ep.object({type:ep.literal("reasoning"),text:ep.string(),state:ep.enum(["streaming","done"]).optional(),providerMetadata:iF.optional()}),ep.object({type:ep.literal("source-url"),sourceId:ep.string(),url:ep.string(),title:ep.string().optional(),providerMetadata:iF.optional()}),ep.object({type:ep.literal("source-document"),sourceId:ep.string(),mediaType:ep.string(),title:ep.string(),filename:ep.string().optional(),providerMetadata:iF.optional()}),ep.object({type:ep.literal("file"),mediaType:ep.string(),filename:ep.string().optional(),url:ep.string(),providerMetadata:iF.optional()}),ep.object({type:ep.literal("step-start")}),ep.object({type:ep.string().startsWith("data-"),id:ep.string().optional(),data:ep.unknown()}),ep.object({type:ep.literal("dynamic-tool"),toolName:ep.string(),toolCallId:ep.string(),state:ep.literal("input-streaming"),input:ep.unknown().optional(),providerExecuted:ep.boolean().optional(),output:ep.never().optional(),errorText:ep.never().optional()}),ep.object({type:ep.literal("dynamic-tool"),toolName:ep.string(),toolCallId:ep.string(),state:ep.literal("input-available"),input:ep.unknown(),providerExecuted:ep.boolean().optional(),output:ep.never().optional(),errorText:ep.never().optional(),callProviderMetadata:iF.optional()}),ep.object({type:ep.literal("dynamic-tool"),toolName:ep.string(),toolCallId:ep.string(),state:ep.literal("output-available"),input:ep.unknown(),providerExecuted:ep.boolean().optional(),output:ep.unknown(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),preliminary:ep.boolean().optional()}),ep.object({type:ep.literal("dynamic-tool"),toolName:ep.string(),toolCallId:ep.string(),state:ep.literal("output-error"),input:ep.unknown(),providerExecuted:ep.boolean().optional(),output:ep.never().optional(),errorText:ep.string(),callProviderMetadata:iF.optional()}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("input-streaming"),providerExecuted:ep.boolean().optional(),input:ep.unknown().optional(),output:ep.never().optional(),errorText:ep.never().optional(),approval:ep.never().optional()}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("input-available"),providerExecuted:ep.boolean().optional(),input:ep.unknown(),output:ep.never().optional(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),approval:ep.never().optional()}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("approval-requested"),input:ep.unknown(),providerExecuted:ep.boolean().optional(),output:ep.never().optional(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),approval:ep.object({id:ep.string(),approved:ep.never().optional(),reason:ep.never().optional()})}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("approval-responded"),input:ep.unknown(),providerExecuted:ep.boolean().optional(),output:ep.never().optional(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),approval:ep.object({id:ep.string(),approved:ep.boolean(),reason:ep.string().optional()})}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("output-available"),providerExecuted:ep.boolean().optional(),input:ep.unknown(),output:ep.unknown(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),preliminary:ep.boolean().optional(),approval:ep.object({id:ep.string(),approved:ep.literal(!0),reason:ep.string().optional()}).optional()}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("output-error"),providerExecuted:ep.boolean().optional(),input:ep.unknown(),output:ep.never().optional(),errorText:ep.string(),callProviderMetadata:iF.optional(),approval:ep.object({id:ep.string(),approved:ep.literal(!0),reason:ep.string().optional()}).optional()}),ep.object({type:ep.string().startsWith("tool-"),toolCallId:ep.string(),state:ep.literal("output-denied"),providerExecuted:ep.boolean().optional(),input:ep.unknown(),output:ep.never().optional(),errorText:ep.never().optional(),callProviderMetadata:iF.optional(),approval:ep.object({id:ep.string(),approved:ep.literal(!1),reason:ep.string().optional()})})]))}))));let oI=process.env.OPENROUTER_API_KEY;if(!oI)throw Error("OPENROUTER_API_KEY is not set.");let oE=tG({apiKey:oI}),oS=30;async function oO(e){let{messages:t}=await e.json(),r=`You are a helpful and concise cloud cost advisor for the 'Priceyy' application. Your only role is to provide information and guidance to the user.

  **CRITICAL RULES:**
  - You have NO ability to perform actions. You cannot add resources, search the database, or navigate the application. You are a chatbot.
  - When a user asks you to "add" or "search for" something, you must explain that you cannot perform actions. Instead, provide them with the information they need to do it themselves using the application's UI.
  - Your knowledge is based on general information about cloud services (AWS, Azure, GCP). You do not have real-time data.
  - Keep your answers direct and focused on providing advice.

  **Example Interaction:**
  User: "add an aws t2.micro instance"
  Your Response: "A t2.micro is a good choice for small workloads. You can add it to your estimate by clicking the 'Add Resource' button and searching for 't2.micro' under the AWS provider."`,a=t.filter(e=>"user"===e.role||"assistant"===e.role).map(e=>{let t=Array.isArray(e.parts)?e.parts.filter(e=>"text"===e.type).map(e=>e.text).join(""):"";return{role:e.role,content:t}}).filter(e=>""!==e.content.trim());return 0===a.length?new Response(JSON.stringify({error:"No valid content in messages"}),{status:400}):(await function({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:l,stopWhen:u=function(e){return({steps:e})=>1===e.length}(0),experimental_output:d,experimental_telemetry:c,prepareStep:p,providerOptions:m,experimental_activeTools:h,activeTools:f=h,experimental_repairToolCall:g,experimental_transform:y,experimental_download:v,includeRawChunks:b=!1,onChunk:_,onError:w=({error:e})=>{console.error(e)},onFinish:x,onAbort:k,onStepFinish:T,experimental_context:I,_internal:{now:E=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:S=ow,currentDate:O=()=>new Date}={},...A}){return new ox({model:ij(e),telemetry:c,headers:l,settings:A,maxRetries:i,abortSignal:o,system:a,prompt:n,messages:s,tools:t,toolChoice:r,transforms:i7(y),activeTools:f,repairToolCall:g,stopConditions:i7(u),output:d,providerOptions:m,prepareStep:p,includeRawChunks:b,onChunk:_,onError:w,onFinish:x,onAbort:k,onStepFinish:T,now:E,currentDate:O,generateId:S,experimental_context:I,download:v})}({model:oE("openrouter/polaris-alpha"),system:r,messages:a})).toUIMessageStreamResponse()}var oA=e.i(1351);let oC=new W.AppRouteRouteModule({definition:{kind:H.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:oA}),{workAsyncStorage:oN,workUnitAsyncStorage:oR,serverHooks:oj}=oC;function oM(){return(0,Y.patchFetch)({workAsyncStorage:oN,workUnitAsyncStorage:oR})}async function oP(e,t,r){var a;let n="/api/chat/route";n=n.replace(/\/index$/,"")||"/";let s=await oC.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:i,params:o,nextConfig:l,isDraftMode:u,prerenderManifest:d,routerServerContext:c,isOnDemandRevalidate:p,revalidateOnlyGenerated:m,resolvedPathname:h}=s,f=(0,Q.normalizeAppPath)(n),g=!!(d.dynamicRoutes[f]||d.routes[h]);if(g&&!u){let e=!!d.routes[h],t=d.dynamicRoutes[f];if(t&&!1===t.fallback&&!e)throw new el.NoFallbackError}let y=null;!g||oC.isDev||u||(y="/index"===(y=h)?"/":y);let v=!0===oC.isDev||!g,b=g&&!v,_=e.method||"GET",w=(0,X.getTracer)(),x=w.getActiveScopeSpan(),k={params:o,prerenderManifest:d,renderOpts:{experimental:{cacheComponents:!!l.experimental.cacheComponents,authInterrupts:!!l.experimental.authInterrupts},supportsDynamicResponse:v,incrementalCache:(0,G.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(a=l.experimental)?void 0:a.cacheLife,isRevalidate:b,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>oC.onRequestError(e,t,a,c)},sharedContext:{buildId:i}},T=new ee.NodeNextRequest(e),I=new ee.NodeNextResponse(t),E=et.NextRequestAdapter.fromNodeNextRequest(T,(0,et.signalFromNodeResponse)(t));try{let a=async r=>oC.handle(E,k).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=w.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==er.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${_} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${_} ${e.url}`)}),s=async s=>{var i,o;let h=async({previousCacheEntry:i})=>{try{if(!(0,G.getRequestMeta)(e,"minimalMode")&&p&&m&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(s);e.fetchMetrics=k.renderOpts.fetchMetrics;let o=k.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let l=k.renderOpts.collectedTags;if(!g)return await (0,en.sendResponse)(T,I,n,k.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,es.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[eo.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==k.renderOpts.collectedRevalidate&&!(k.renderOpts.collectedRevalidate>=eo.INFINITE_CACHE)&&k.renderOpts.collectedRevalidate,a=void 0===k.renderOpts.collectedExpire||k.renderOpts.collectedExpire>=eo.INFINITE_CACHE?void 0:k.renderOpts.collectedExpire;return{value:{kind:eu.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==i?void 0:i.isStale)&&await oC.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,ea.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:p})},c),t}},f=await oC.handleResponse({req:e,nextConfig:l,cacheKey:y,routeKind:H.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:d,isRoutePPREnabled:!1,isOnDemandRevalidate:p,revalidateOnlyGenerated:m,responseGenerator:h,waitUntil:r.waitUntil});if(!g)return null;if((null==f||null==(i=f.value)?void 0:i.kind)!==eu.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(o=f.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,G.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",p?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),u&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,es.fromNodeOutgoingHttpHeaders)(f.value.headers);return(0,G.getRequestMeta)(e,"minimalMode")&&g||v.delete(eo.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,ei.getCacheControlHeader)(f.cacheControl)),await (0,en.sendResponse)(T,I,new Response(f.value.body,{headers:v,status:f.value.status||200})),null};x?await s(x):await w.withPropagatedContext(e.headers,()=>w.trace(er.BaseServerSpan.handleRequest,{spanName:`${_} ${e.url}`,kind:X.SpanKind.SERVER,attributes:{"http.method":_,"http.target":e.url}},s))}catch(t){if(t instanceof el.NoFallbackError||await oC.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,ea.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:p})}),g)throw t;return await (0,en.sendResponse)(T,I,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_e7e4d69b._.js.map